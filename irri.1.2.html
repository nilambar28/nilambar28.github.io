<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Interface - Fixed</title>
    <style>
        :root {
            --primary: #007bff;
            --success: #27ae60;     /* Green */
            --danger: #c0392b;      /* Red */
            --review: #8e44ad;      /* Purple */
            --warning: #f39c12;     /* Orange/Yellow */
            --gray: #ecf0f1;
            --dark: #2c3e50;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background: #f4f6f9; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        header {
            background: #fff; height: 60px; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd;
        }
        .timer-box { font-size: 1.2rem; font-weight: bold; color: var(--dark); font-family: monospace; }
        .btn-exit { border: 1px solid var(--danger); color: var(--danger); background: white; padding: 5px 10px; border-radius: 4px; cursor: pointer; }

        /* LAYOUT */
        #quiz-interface { display: flex; flex: 1; overflow: hidden; }

        /* LEFT: QUESTION */
        .question-section { flex: 1; padding: 20px; overflow-y: auto; padding-bottom: 80px; }
        .q-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 900px; margin: 0 auto; }
        
        .q-text { font-size: 1.1rem; font-weight: 500; margin-bottom: 20px; line-height: 1.5; }
        .q-tag { float: right; background: #e3f2fd; color: var(--primary); font-size: 0.75rem; padding: 2px 6px; border-radius: 4px; }

        .option-item {
            display: flex; align-items: center; gap: 10px; padding: 12px; border: 1px solid #eee; 
            border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: 0.2s;
        }
        .option-item:hover { background: #f9f9f9; }
        .option-item.selected { background: #e7f1ff; border-color: var(--primary); }
        .circle { 
            width: 24px; height: 24px; border-radius: 50%; border: 2px solid #bbb; 
            display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; color: #666; 
        }
        .option-item.selected .circle { background: var(--primary); border-color: var(--primary); color: white; }

        /* RIGHT: PALETTE */
        .sidebar { width: 300px; background: #fff; border-left: 1px solid #ddd; display: flex; flex-direction: column; z-index: 100; }
        .palette-legend { padding: 10px; border-bottom: 1px solid #eee; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.75rem; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .box-icon { width: 12px; height: 12px; border-radius: 2px; }

        .palette-grid { padding: 15px; overflow-y: auto; flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; align-content: start; }
        
        .pal-btn {
            height: 35px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 4px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: 600; font-size: 0.9rem; position: relative;
        }
        
        /* PALETTE COLORS */
        .pal-btn.current { border: 2px solid #000; }
        .pal-btn.answered { background: var(--success); color: white; border-color: var(--success); clip-path: polygon(0 0, 100% 0, 100% 80%, 80% 100%, 0 100%); }
        .pal-btn.not-answered { background: var(--danger); color: white; border-color: var(--danger); clip-path: polygon(0 0, 100% 0, 100% 80%, 80% 100%, 0 100%); }
        .pal-btn.review { background: var(--review); color: white; border-color: var(--review); border-radius: 50%; }
        
        /* Answered AND Marked for Review (Purple with Green Dot) */
        .pal-btn.review-answered {
            background: var(--review); color: white; border-radius: 50%; position: relative;
        }
        .pal-btn.review-answered::after {
            content: "✓"; font-size: 10px; position: absolute; bottom: 0; right: 0; 
            background: var(--success); width: 14px; height: 14px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
        }

        /* FOOTER */
        footer {
            height: 60px; background: #fff; border-top: 1px solid #ddd; position: fixed; bottom: 0; left: 0; width: 100%;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 200;
        }
        @media (min-width: 768px) { footer { width: calc(100% - 300px); } }
        
        .btn { padding: 10px 15px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; }
        .btn-prev { background: #7f8c8d; }
        .btn-next { background: var(--success); }
        .btn-review { background: var(--review); }
        .btn-review.active { background: var(--warning); color: #fff; } /* Yellow when active */
        .btn-submit { width: 100%; background: #2ecc71; margin-top: 10px; }

        /* MOBILE */
        @media (max-width: 768px) {
            .sidebar { position: fixed; top: 60px; right: -100%; height: calc(100% - 60px); transition: 0.3s; }
            .sidebar.open { right: 0; }
            footer { width: 100%; }
        }

        .hidden { display: none !important; }
        #result-screen { padding: 40px; text-align: center; max-width: 800px; margin: 0 auto; overflow-y: auto; height: 100vh;}
    </style>
</head>
<body>

    <div id="start-screen" style="padding: 40px; text-align: center;">
        <h1 style="color:var(--primary)">Civil Engg Mock</h1>
        <p>32 Questions | 120 Minutes</p>
        <button class="btn btn-next" onclick="startTest()" style="margin-top: 20px; padding: 12px 30px;">Start Test</button>
    </div>

    <div id="exam-interface" class="hidden" style="height: 100%; display: flex; flex-direction: column;">
        <header>
            <strong>Irrigation Test</strong>
            <div class="timer-box" id="timer">02:00:00</div>
            <div style="display:flex; gap:10px">
                <button onclick="toggleSidebar()" style="background:none; border:1px solid #ccc; padding:5px;">☰</button>
                <button class="btn-exit" onclick="exitTest()">Exit</button>
            </div>
        </header>

        <div id="quiz-interface">
            <div class="question-section" id="q-area"></div>

            <div class="sidebar" id="sidebar">
                <div class="palette-legend">
                    <div class="legend-item"><div class="box-icon" style="background:var(--success)"></div> Ans</div>
                    <div class="legend-item"><div class="box-icon" style="background:var(--danger)"></div> Not Ans</div>
                    <div class="legend-item"><div class="box-icon" style="background:var(--review); border-radius:50%"></div> Review</div>
                    <div class="legend-item"><div class="box-icon" style="background:var(--review); border-radius:50%"></div><span style="font-size:8px">✓</span> Ans+Rev</div>
                </div>
                <div class="palette-grid" id="palette-grid"></div>
                <div style="padding:15px; border-top:1px solid #ddd">
                    <button class="btn btn-submit" onclick="submitTest()">Submit Test</button>
                </div>
            </div>
        </div>

        <footer>
            <button class="btn btn-prev" id="btn-prev" onclick="nav(-1)">Previous</button>
            <button class="btn btn-review" id="btn-review" onclick="toggleReview()">Mark for Review</button>
            <button class="btn btn-next" id="btn-next" onclick="nav(1)">Save & Next</button>
        </footer>
    </div>

    <div id="result-screen" class="hidden">
        <h1>Result</h1>
        <h2 id="score-disp" style="font-size:3rem; color:var(--primary)">0%</h2>
        <div id="sol-container" style="text-align: left; margin-top:30px"></div>
        <button class="btn btn-next" onclick="location.reload()" style="margin:20px 0;">Home</button>
    </div>

<script>
    // --- DATA ---
    const questions = [
        { id: 58, text: "In irrigation engineering, development of desert area factor comes under which case?", options: ["Necessity of irrigation", "Ill-effects of irrigation", "Benefits of irrigation", "Types of irrigation"], correct: 0, tag: "DSSSB JE 2019", sol: "Desert area factor falls under Necessity of Irrigation." },
        { id: 59, text: "For spray application, the quantity to be applied in a field will depend upon:", options: ["Pressure", "Forward speed", "No. of nozzles", "All of these"], correct: 3, tag: "HPSSC JE 2018", sol: "Depends on pressure, speed, and nozzles." },
        { id: 60, text: "Irrigation water eyed to the land by means gravity flow indicates which type?", options: ["Drip irrigation", "Flow irrigation", "Lift irrigation", "Sprinkler irrigation"], correct: 1, tag: "NWDA JE 2018", sol: "Gravity flow = Flow Irrigation." },
        { id: 61, text: "With increase in supply of irrigation water, crop yields...", options: ["decrease continuously", "increase continuously", "increase up to limit then constant", "increase up to limit then decrease"], correct: 3, tag: "SSC JE 2018", sol: "Increases up to a limit, then decreases (waterlogging)." },
        { id: 62, text: "Surface irrigation method generally practiced in hilly area is:", options: ["Flooding", "Furrow method", "Contour farming", "Sprinkler irrigation"], correct: 2, tag: "GSSSB ITI 2016", sol: "Contour farming fits hilly terrain." },
        { id: 63, text: "Out of total liquid water on earth, brackish water is:", options: ["above 95 percent", "around 75 percent", "around 50 percent", "not available"], correct: 0, tag: "Manipur AE 2016", sol: "95% is salty/brackish." },
        { id: 64, text: "Also called inundation irrigation?", options: ["Flow irrigation", "Combined scheme", "Storage irrigation", "Diversion irrigation"], correct: 0, tag: "SSC JE 2019", sol: "Inundation is a type of Flow Irrigation." },
        { id: 65, text: "Correct statement for sprinkler irrigation?", options: ["Used for rice/jute", "Used for low infiltration soil", "Best for very light soil", "Requires borders"], correct: 2, tag: "SSC JE 2018", sol: "Best for light (sandy) soil." },
        { id: 66, text: "Method where each tree is surrounded by a border to form a pool:", options: ["Basin irrigation", "Broad irrigation", "Distributed irrigation", "Spot irrigation"], correct: 0, tag: "Rajasthan JEN 2020", sol: "Basin irrigation." },
        { id: 67, text: "Lands neither arid nor strictly humid where inferior crops grow without irrigation?", options: ["Hybrid arid", "Medium arid", "Partly arid", "Semi arid zone"], correct: 3, tag: "Rajasthan JEN 2020", sol: "Semi arid zone." },
        { id: 68, text: "System suitable where there are number of small rivers and streams:", options: ["Bandhara system", "Closed system", "Well system", "Lifting system"], correct: 0, tag: "UKSSSC JE 2020", sol: "Bandhara system." },
        { id: 69, text: "Entire field divided into leveled plots surrounded by levees?", options: ["basin method", "Check method", "Furrow method", "Border strip"], correct: 1, tag: "UPPCL JE 2020", sol: "Check flooding." },
        { id: 70, text: "For standing crops in undulating sandy fields, best method is:", options: ["Sprinkler Irrigation", "Check method", "Furrow method", "All of these"], correct: 0, tag: "Mizoram PSC 2015", sol: "Sprinkler handles undulating sandy land best." },
        { id: 71, text: "Method where only 1/5 to 1/2 of land is wetted:", options: ["Border", "Basin", "Sprinkler", "Furrow irrigation"], correct: 3, tag: "MP VYAPAM 2017", sol: "Furrow irrigation reduces evaporation." },
        { id: 72, text: "'Corrugations' is associated with:", options: ["Furrow irrigation", "Basin irrigation", "Sprinkler irrigation", "Drip irrigation"], correct: 0, tag: "MH PWD 2019", sol: "Small furrows = Corrugations." },
        { id: 73, text: "Irrigation for cereal crops is:", options: ["Sub surface", "Basin flooding", "Check flooding", "Furrow irrigation"], correct: 2, tag: "Nagaland PSC 2015", sol: "Check flooding." },
        { id: 74, text: "'Flood irrigation' works best on:", options: ["Level/gentle terrain", "Steep terrain", "Drought areas", "Coasted areas"], correct: 0, tag: "Nagaland PSC 2015", sol: "Level or gentle terrain." },
        { id: 75, text: "Water held in soil by surface tension against gravity:", options: ["Hydroscopic", "Surface", "Capillary", "Centrifugal"], correct: 2, tag: "Karnataka PSC", sol: "Capillary water." },
        { id: 76, text: "Water in excess of hygroscopic water existing by molecular attraction:", options: ["Sea", "River", "Capillary", "None"], correct: 2, tag: "Kerala PSC 2019", sol: "Capillary water." },
        { id: 77, text: "Permanent wilting point moisture represents:", options: ["Hygroscopic water", "Capillary", "Field capacity", "None"], correct: 0, tag: "UJVNL AE 2021", sol: "Hygroscopic (Unavailable) water." },
        { id: 78, text: "Most fertile soil is:", options: ["Alluvial", "Black", "Laterite", "Red"], correct: 0, tag: "Nagaland PSC 2016", sol: "Alluvial soil." },
        { id: 79, text: "Water requirement is highest for:", options: ["livestock", "irrigation", "domestic", "toughness"], correct: 1, tag: "APPSC AE 2004", sol: "Irrigation consumes ~70%." },
        { id: 80, text: "Kharif season extends from:", options: ["Jan-July", "Mar-Aug", "Sept-Apr", "June-October"], correct: 3, tag: "APPSC AE 2004", sol: "June to October." },
        { id: 81, text: "Region lacking water without artificial irrigation:", options: ["arid zone", "dry zone", "desert", "none"], correct: 0, tag: "APPSC AEE 2011", sol: "Arid Zone." },
        { id: 82, text: "Decrease order of wetting area (Furrow, Sprinkler, Drip):", options: ["I, II, III", "II, III, I", "III, I, II", "II, I, III"], correct: 3, tag: "Punjab JE 2016", sol: "Sprinkler > Furrow > Drip." },
        { id: 83, text: "Crops on sides of water ditches:", options: ["Drip", "Flood", "Furrow", "Check"], correct: 2, tag: "NPCC 2017", sol: "Furrow irrigation." },
        { id: 84, text: "Underground water table corresponds to level of:", options: ["streams", "rivers", "sea", "all of these"], correct: 3, tag: "Mizoram PSC 2016", sol: "All of these." },
        { id: 85, text: "Assertion: Border strip depends on soil. Reason: It is subsurface.", options: ["Both true", "Both true not expl", "A true R false", "A false R true"], correct: 2, tag: "ESE 2010", sol: "Border strip is Surface irrigation. R is False." },
        { id: 86, text: "Assertion: Sprinkler higher efficiency. Reason: Less interference.", options: ["Both true", "Both true not expl", "A true R false", "A false R true"], correct: 2, tag: "Unknown", sol: "Sprinkler causes MORE interference (pipes). R is False." },
        { id: 87, text: "Not a major deterrent in water harvesting tanks?", options: ["Deforestation", "Siltation", "Lack of maintenance", "Shallow depth"], correct: 3, tag: "ESE 2020", sol: "Shallow depth is not a major issue compared to others." },
        { id: 88, text: "Lift irrigation doesn't include:", options: ["Doon", "Deep tube wells", "Mote", "Indundation"], correct: 3, tag: "Nagaland PSC 2017", sol: "Inundation is flow type, not lift." },
        { id: 89, text: "Applying water directly to root zone:", options: ["check", "drip", "furrow", "sprinkle"], correct: 1, tag: "SSC JE 2018", sol: "Drip irrigation." }
    ];

    // --- STATE ---
    let currentQ = 0;
    let answers = new Array(questions.length).fill(null);
    let reviews = new Array(questions.length).fill(false); // Stores Review State
    let visited = new Array(questions.length).fill(false);
    let timerRef;

    // --- LOGIC ---
    function startTest() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('exam-interface').classList.remove('hidden');
        document.getElementById('exam-interface').style.display = 'flex';
        
        visited[0] = true;
        initPalette();
        renderQ(0);
        
        let time = 7200;
        timerRef = setInterval(() => {
            time--;
            if(time <= 0) submitTest();
            let h = Math.floor(time/3600).toString().padStart(2,'0');
            let m = Math.floor((time%3600)/60).toString().padStart(2,'0');
            let s = (time%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }

    function initPalette() {
        const grid = document.getElementById('palette-grid');
        grid.innerHTML = '';
        questions.forEach((_, i) => {
            const btn = document.createElement('div');
            btn.className = 'pal-btn';
            btn.innerText = i + 1;
            btn.id = `pal-${i}`;
            btn.onclick = () => renderQ(i);
            grid.appendChild(btn);
        });
        updatePalette();
    }

    function renderQ(index) {
        currentQ = index;
        visited[index] = true;
        const q = questions[index];
        
        // Render Text
        document.getElementById('q-area').innerHTML = `
            <div class="q-card">
                <div style="overflow:hidden; margin-bottom:10px;">
                    <span style="color:var(--primary); font-weight:bold;">Question ${index+1}</span>
                    <span class="q-tag">${q.tag}</span>
                </div>
                <div class="q-text">Q.${q.id}: ${q.text}</div>
                <div>${q.options.map((o, i) => `
                    <div class="option-item ${answers[index] === i ? 'selected' : ''}" onclick="setAns(${i})">
                        <div class="circle">${['A','B','C','D'][i]}</div> ${o}
                    </div>`).join('')}
                </div>
            </div>
        `;

        // Update Buttons
        document.getElementById('btn-prev').disabled = index === 0;
        document.getElementById('btn-next').innerText = index === questions.length-1 ? "Submit" : "Save & Next";
        
        // Update Review Button Appearance (FEEDBACK FIXED)
        const revBtn = document.getElementById('btn-review');
        if(reviews[index]) {
            revBtn.innerText = "Unmark Review";
            revBtn.classList.add('active');
        } else {
            revBtn.innerText = "Mark for Review";
            revBtn.classList.remove('active');
        }

        updatePalette();
        if(window.innerWidth < 768) document.getElementById('sidebar').classList.remove('open');
    }

    function setAns(optIndex) {
        answers[currentQ] = optIndex;
        renderQ(currentQ);
    }

    function toggleReview() {
        reviews[currentQ] = !reviews[currentQ]; // Toggle state
        renderQ(currentQ); // Re-render to show button change
    }

    function nav(dir) {
        let next = currentQ + dir;
        if(next >= 0 && next < questions.length) renderQ(next);
        else if (dir === 1) submitTest();
    }

    function updatePalette() {
        questions.forEach((_, i) => {
            const btn = document.getElementById(`pal-${i}`);
            btn.className = 'pal-btn'; // Reset
            
            if(i === currentQ) btn.classList.add('current');

            // PRIORITY LOGIC (Review Overrides All)
            if(reviews[i]) {
                if(answers[i] !== null) btn.classList.add('review-answered'); // Purple + Green Dot
                else btn.classList.add('review'); // Just Purple
            } 
            else if(answers[i] !== null) btn.classList.add('answered'); // Green
            else if(visited[i]) btn.classList.add('not-answered'); // Red
        });
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function submitTest() {
        if(!confirm("Submit Test?")) return;
        clearInterval(timerRef);
        document.getElementById('exam-interface').style.display = 'none';
        document.getElementById('result-screen').classList.remove('hidden');

        let correct = 0;
        questions.forEach((q, i) => {
            if(answers[i] === q.correct) correct++;
        });

        document.getElementById('score-disp').innerText = Math.round((correct/questions.length)*100) + "%";
        document.getElementById('sol-container').innerHTML = questions.map((q, i) => `
            <div style="background:#fff; padding:15px; margin-bottom:10px; border-radius:8px; border:1px solid #eee;">
                <strong>Q${q.id}</strong>: ${q.text}<br>
                <div style="font-size:0.9rem; color:#666; margin-top:5px;">
                    Correct: <span style="color:green; font-weight:bold">${q.options[q.correct]}</span>
                </div>
                <div style="background:#e8f5e9; padding:5px; font-size:0.85rem; margin-top:5px;">Sol: ${q.sol}</div>
            </div>
        `).join('');
    }

    function exitTest() { if(confirm("Exit?")) location.reload(); }

</script>
</body>
</html>

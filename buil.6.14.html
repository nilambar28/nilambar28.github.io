<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Building Materials Test (Cement)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #2962FF; /* Testbook Blue */
            --success: #00C853; /* Green */
            --error: #D50000;   /* Red */
            --bg-light: #F5F7FA;
            --text-dark: #333;
            --text-light: #666;
            --border: #e0e0e0;
            --palette-skipped: #E0E0E0;
            --palette-answered: #00C853;
            --palette-review: #7B1FA2;
            --palette-current: #2962FF;
            --gold: #FFC107;
        }

        * { box-sizing: border-box; font-family: 'Roboto', 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        body { background-color: var(--bg-light); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- Start Screen --- */
        .screen { display: none; height: 100%; flex-direction: column; }
        .screen.active { display: flex; }
        
        #start-screen { justify-content: center; align-items: center; text-align: center; padding: 20px; overflow-y: auto; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 400px; width: 100%; margin-bottom: 20px; }
        
        .btn-primary { background: var(--primary); color: white; border: none; padding: 14px 24px; border-radius: 6px; font-size: 16px; cursor: pointer; width: 100%; font-weight: bold; transition: 0.2s; box-shadow: 0 4px 6px rgba(41, 98, 255, 0.2); }
        .btn-primary:active { transform: translateY(2px); }
        
        .btn-bookmark-start { background: white; color: var(--text-dark); border: 2px solid var(--gold); padding: 12px 24px; border-radius: 6px; font-size: 15px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; transition: 0.2s; }
        .btn-bookmark-start:hover { background: #FFF8E1; }

        /* --- Test Interface --- */
        header { background: white; padding: 10px 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .timer-box { font-weight: bold; color: var(--text-dark); background: #eee; padding: 5px 10px; border-radius: 4px; }
        .submit-btn { background: var(--success); color: white; border: none; padding: 6px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .exit-btn { background: var(--error); color: white; border: none; padding: 6px 15px; border-radius: 4px; margin-right: 10px; cursor: pointer; }

        #test-body { flex: 1; display: flex; overflow: hidden; position: relative; }
        #question-area { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        
        .q-header { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        .exam-tag { font-size: 11px; background: #FFF3E0; color: #E65100; padding: 2px 6px; border-radius: 3px; border: 1px solid #FFCC80; }
        .q-text { font-size: 16px; font-weight: 500; margin-bottom: 15px; line-height: 1.5; color: var(--text-dark); }
        
        /* Options */
        .options-list { list-style: none; }
        .option-item { display: flex; align-items: center; padding: 12px; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 10px; cursor: pointer; transition: background 0.2s; }
        .option-circle { width: 25px; height: 25px; border: 2px solid #999; border-radius: 50%; margin-right: 12px; display: flex; justify-content: center; align-items: center; font-size: 12px; color: #666; font-weight: bold; flex-shrink: 0; }
        
        .option-item.correct { border-color: var(--success); background: #E8F5E9; }
        .option-item.correct .option-circle { background: var(--success); border-color: var(--success); color: white; }
        .option-item.wrong { border-color: var(--error); background: #FFEBEE; }
        .option-item.wrong .option-circle { background: var(--error); border-color: var(--error); color: white; }
        .option-item.disabled { pointer-events: none; }

        /* Explanation */
        .solution-box { margin-top: 20px; background: #F1F8E9; border: 1px solid #C5E1A5; border-radius: 6px; padding: 15px; display: none; }
        .sol-title { font-weight: bold; color: var(--success); margin-bottom: 5px; font-size: 14px; }
        .sol-text { font-size: 14px; color: #333; line-height: 1.4; }
        
        /* Image Tags */
        .img-tag { display: inline-block; background: #E3F2FD; color: var(--primary); padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 5px 0; border: 1px dashed var(--primary); cursor: pointer; }
        .citation { font-size: 0.8em; color: #666; font-style: italic; margin-left: 5px; }

        /* Footer */
        footer { background: white; padding: 10px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: absolute; bottom: 0; width: 100%; z-index: 10; }
        .nav-btn { background: white; border: 1px solid var(--border); padding: 8px 16px; border-radius: 4px; font-weight: bold; color: var(--text-light); cursor: pointer; }
        .nav-btn.primary { background: var(--primary); color: white; border: none; }
        .bookmark-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #aaa; padding: 0 10px; }
        .bookmark-btn.active { color: var(--gold); }

        /* Palette */
        #palette-drawer { width: 280px; background: white; border-left: 1px solid var(--border); display: flex; flex-direction: column; position: absolute; right: -280px; top: 0; bottom: 0; transition: right 0.3s; z-index: 20; height: 100%; }
        #palette-drawer.open { right: 0; }
        .palette-header { padding: 15px; background: #f5f5f5; border-bottom: 1px solid var(--border); font-weight: bold; display: flex; justify-content: space-between; }
        .grid-container { padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; overflow-y: auto; }
        .grid-item { width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 12px; cursor: pointer; background: var(--palette-skipped); color: #333; }
        .grid-item.current { border: 2px solid var(--palette-current); }
        .grid-item.answered { background: var(--palette-answered); color: white; }
        .grid-item.review { background: var(--palette-review); color: white; }

        /* Result Screen */
        #result-screen { padding: 20px; overflow-y: auto; background: #f0f2f5; }
        .score-circle { width: 120px; height: 120px; border-radius: 50%; border: 8px solid var(--primary); display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto 20px; font-size: 24px; font-weight: bold; background: white; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 12px; background: white; border-radius: 6px; }

        @media (min-width: 769px) {
            #test-body { padding-right: 280px; }
            #palette-drawer { right: 0; border-left: 1px solid var(--border); }
            .toggle-palette { display: none; }
        }
    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <div class="card">
            <h2 style="color: var(--primary);">Cement Technology</h2>
            <p style="margin: 10px 0; color: #666;">Questions 1109 - 1139</p>
            <div style="text-align: left; margin: 15px 0; font-size: 14px; background: #f5f5f5; padding: 10px; border-radius: 6px;">
                <p>âœ… <strong>Total Qs:</strong> 31</p>
                <p>âœ… <strong>Time:</strong> 2 Hours</p>
                <p>âœ… <strong>Source:</strong> Previous Year Papers</p>
            </div>
            
            <button class="btn-primary" onclick="app.startTest('full')">START FULL TEST</button>
            
            <button class="btn-bookmark-start" onclick="app.startTest('bookmark')">
                <span>ðŸ”–</span> PRACTICE BOOKMARKS
            </button>
        </div>
        <div class="card">
            <h3>History</h3>
            <div id="history-list"></div>
        </div>
    </div>

    <div id="test-screen" class="screen">
        <header>
            <button class="exit-btn" onclick="app.exitTest()">Exit</button>
            <div class="timer-box" id="timer">02:00:00</div>
            <button class="submit-btn" onclick="app.submitTest()">Submit</button>
        </header>

        <div id="test-body">
            <div id="question-area"></div>
            
            <div id="palette-drawer">
                <div class="palette-header">
                    <span>Question Grid</span>
                    <span class="toggle-palette" onclick="app.togglePalette()" style="cursor:pointer;">âœ•</span>
                </div>
                <div class="grid-container" id="grid-box"></div>
            </div>
        </div>

        <footer>
            <button class="nav-btn" onclick="app.prevQuestion()">Prev</button>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button class="bookmark-btn" id="bookmark-btn" onclick="app.toggleBookmark()">
                    <i class="fas fa-bookmark"></i>
                </button>
                <button class="nav-btn" style="color: var(--palette-review); border-color: var(--palette-review);" onclick="app.markReview()">Review</button>
                <button class="nav-btn toggle-palette" onclick="app.togglePalette()">â˜°</button>
            </div>
            <button class="nav-btn primary" onclick="app.nextQuestion()">Next</button>
        </footer>
    </div>

    <div id="result-screen" class="screen">
        <div class="card" style="margin: 0 auto; max-width: 600px;">
            <h2 style="text-align:center; margin-bottom:20px;">Test Report</h2>
            <div class="score-circle">
                <span id="score-val">0</span>
                <span style="font-size:14px; font-weight:normal; color:#666;">Score</span>
            </div>
            
            <div class="stat-row">
                <span>Total Questions</span>
                <span id="res-total" style="font-weight:bold;">31</span>
            </div>
            <div class="stat-row">
                <span>Attempted</span>
                <span id="res-attempted" style="font-weight:bold;">0</span>
            </div>
            <div class="stat-row">
                <span>Accuracy</span>
                <span id="res-accuracy" style="font-weight:bold; color:var(--primary);">0%</span>
            </div>

            <button class="btn-primary" onclick="location.reload()">Back to Home</button>
        </div>
    </div>

<script>
// --- DATA: Transcribed from Images 1109-1139 ---
const rawData = [
    {id: 1109, question: "The apparatus used to determine water content required to prepare cement water paste of standard consistency is", options: ["Blain's air permeability apparatus", "Le Chatelier's apparatus", "Vicat's apparatus", "Any of these"], ans: 2, tag: "NWRD SHIFT 1, 25.11.2016", explanation: "Vicat's apparatus is used to determine consistency and initial / final setting times of cement pastes.<br>Amount of water used to make paste of normal consistency is about 25-30% generally.<br>"},
    {id: 1110, question: "Compressive strength developed by concrete made with ordinary Portland cement at the fourteenth day after casting is about % of its 28 days compressive strength.", options: ["None of these", "37", "85", "70"], ans: 2, tag: "NWRD SHIFT 1, 25.11.2016", explanation: "Strength gain table:<br>1 day: 16%<br>3 days: 40%<br>7 days: 65%<br>14 days: 90% (Closest option is 85%)<br>28 days: 99%<br>"},
    {id: 1111, question: "Which of the following statement is true?", options: ["The first compound of cement which first react with water is Câ‚‚S.", "If the particles of sand are fine, bulking is less.", "Curing of concrete increase its shrinkage.", "Adding gypsum in cement increases the setting time"], ans: 3, tag: "UPRVUNL JE 2014", explanation: "Generally, gypsum is added in the range of 2%-3% to cement for delaying the setting time of cement.<br>Statement (a) is false, C3A reacts first."},
    {id: 1112, question: "Reducing the water-cement ratio :", options: ["Increase to creaps", "Increase the leakage", "Reduce to fast resistance", "Increase to wearing resistance"], ans: 3, tag: "UPRVUNL JE 2014", explanation: "If water cement ratio decrease then workability will reduce but compressive strength will increases.<br>Increased strength leads to increased wearing resistance."},
    {id: 1113, question: "Which of the following mixture is fused to make high alumina cement?", options: ["Lime stone, bauxite or gypsum", "Lime stone, gypsum, bauxite clay and chalk", "Lime stone, gypsum and soil clay", "Lime stone and bauxite"], ans: 3, tag: "UPRVUNL JE 2014", explanation: "High alumina cement = Bauxite (40%), lime stone (40%), iron oxide (15%).<br>Initial setting time - 3.5 to 4 hours.<br>Final setting time - 5 to 5.5 hours."},
    {id: 1114, question: "Low heat cement contains lower percentage of which of the following?", options: ["Câ‚ƒA", "Câ‚‚S", "Câ‚ƒS", "Câ‚„AF"], ans: 0, tag: "HPSSC JE Code 519/2018", explanation: "Low heat cement contains Câ‚ƒA lower in percentage compare to Câ‚‚S because heat of hydration produced by Câ‚ƒA is more compare to Câ‚‚S."},
    {id: 1115, question: "Which type of cement is obtained by mixing Portland cement clinker, gypsum and granulated blast furnace slag in suitable proportions and grinding?", options: ["Ordinary Portland cement", "Portland slag cement", "Quick setting cement", "Sulphate resisting cement"], ans: 1, tag: "DMRC JE 19.2.2020 (Evening)", explanation: "Portland slag cement is produced by inter grinding cement clinkers, hard burnt gypsum and granulated blast furnace slag.<br>Properties: Higher resistance against chemical attack, Low heat of hydration."},
    {id: 1116, question: "When kept in upright position, the dimensions in cm (in sequence of top dia, height and bottom dia) of the slump cone used for determining workability by slump test are :", options: ["10, 20, 30", "10, 30, 20", "30, 20, 10", "20, 30, 10"], ans: 1, tag: "HPSSC JE CODE 552/2018", explanation: "The apparatus consists of a metallic mould shape of frustum having bottom dia 20 cm, top dia 10 cm & height 30 cm.<br>"},
    {id: 1117, question: "The type of cement, most commonly available in open market in Himachal Pradesh is :", options: ["OPC", "White Cement", "Fibre Cement", "PPC"], ans: 3, tag: "HPSSC JE CODE 552/2018", explanation: "Portland pozzolana cement (PPC) is mostly available in open market in Himachal Pradesh. It is used where more freezing, thawing and durability is required."},
    {id: 1118, question: "Which of the following does not belong to bogue compounds?", options: ["Tri-calcium aluminate", "Di-calcium silicate", "Tetra-calcium alumino ferrate", "Di-calcium aluminate"], ans: 3, tag: "HPSSC JE Code 545/2018", explanation: "Bogue's compounds are: C3A, C4AF, C3S, and C2S. Di-calcium aluminate is NOT one."},
    {id: 1119, question: "The Silica in portland cement is:", options: ["10 to 20%", "20 to 25%", "25 to 40%", "40 to 60%"], ans: 1, tag: "HPSSC JE CODE 502/2018", explanation: "Chemical composition of cement:<br>Lime (CaO): 62-67%<br>Silica (SiOâ‚‚): 17-25%<br>Alumina (Alâ‚‚Oâ‚ƒ): 3-8%"},
    {id: 1120, question: "How much quantity of gypsum is added during the manufacturing of Portland cement?", options: ["3 to 5%", "1 to 2%", "3 to 6%", "2 to 4%"], ans: 0, tag: "HSSC JE 12.4.2018", explanation: "Generally, gypsum is added in the range of 3-5% to cement for delaying the setting time of cement."},
    {id: 1121, question: "Which of the following Bogue's compounds of cement liberates maximum heat of hydration?", options: ["Câ‚ƒA", "Câ‚‚S", "Câ‚ƒS", "Câ‚„AF"], ans: 0, tag: "SSC JE 2012", explanation: "Heat of hydration data:<br>Câ‚ƒA: 865 J/gm (Highest)<br>Câ‚ƒS: 500 J/gm<br>Câ‚‚S: 260 J/gm (Lowest)"},
    {id: 1122, question: "As per IS : 456-2000, the organic content of water used for making concrete should NOT be more than", options: ["100 mg/L", "150 mg/L", "200 mg/L", "250 mg/L"], ans: 2, tag: "SSC JE 2012", explanation: "As per IS : 456-2000, the organic content of water used for making concrete should NOT be more than 200mg/L."},
    {id: 1123, question: "Soundness test of cement determines", options: ["Quality of free lime", "Ultimate strength", "Durability", "Initial setting time"], ans: 0, tag: "SSC JE 2013", explanation: "Soundness test detects the presence of uncombined lime (free lime) and magnesia in cement.<br>"},
    {id: 1124, question: "For ordinary Portland cement, the initial setting time should not be less than:", options: ["10 minutes", "30 minutes", "60 minutes", "600 minutes"], ans: 1, tag: "SSC JE 2013", explanation: "For Ordinary Portland Cement (OPC), initial setting time should not be less than 30 minutes and final setting time not more than 10 hours."},
    {id: 1125, question: "The main ingredients of Portland cement are:", options: ["Lime and Silica", "Lime and Alumina", "Silica and Alumina", "Lime and Iron"], ans: 0, tag: "SSC JE 2014", explanation: "Lime (CaO) ~63% and Silica (SiO2) ~20% are the two major constituents of Portland Cement."},
    {id: 1126, question: "Specific gravity of OPC is generally:", options: ["4.92", "3.15", "2.10", "1.75"], ans: 1, tag: "SSC JE 2014", explanation: "The specific gravity of Ordinary Portland Cement is generally taken as 3.15."},
    {id: 1127, question: "In concrete, if the maximum size of aggregate is increased, the workability:", options: ["Increases", "Decreases", "Remains same", "None of these"], ans: 0, tag: "SSC JE 2015", explanation: "For the same water-cement ratio, larger aggregate has less surface area, requiring less water for lubrication, thus increasing workability."},
    {id: 1128, question: "One bag of cement (50 kg) is equal to:", options: ["0.023 mÂ³", "0.035 mÂ³", "0.050 mÂ³", "0.025 mÂ³"], ans: 1, tag: "SSC JE 2016", explanation: "Volume of 50kg cement = Mass / Density = 50 / 1440 = 0.0347 mÂ³ â‰ˆ 0.035 mÂ³ (35 Liters)."},
    {id: 1129, question: "To determine the modulus of rupture, the size of test specimen used is:", options: ["150x150x500 mm", "100x100x500 mm", "150x150x700 mm", "100x100x700 mm"], ans: 2, tag: "SSC JE 2016", explanation: "For modulus of rupture (flexural strength), beam specimens of size 150x150x700 mm are typically used.<br>"},
    {id: 1130, question: "The property of fresh concrete, in which the water in the mix tends to rise to the surface while placing and compacting, is called:", options: ["Segregation", "Bleeding", "Bulking", "Creep"], ans: 1, tag: "SSC JE 2016", explanation: "Bleeding is a form of segregation where water comes out to the surface of the concrete, being the lightest ingredient."},
    {id: 1131, question: "Identify the correct statement:", options: ["White cement is suitable for ordinary work", "Pozzolana cement is grey in colour", "C3S is responsible for 28 day strength", "C3A is responsible for 28 day strength"], ans: 2, tag: "SSC JE 2016", explanation: "C3S (Tricalcium Silicate) is responsible for early strength (first 28 days). C2S contributes to ultimate strength."},
    {id: 1132, question: "Workability of concrete is measured by:", options: ["Vicat apparatus test", "Slump test", "Minimum void method", "Talbot Richard test"], ans: 1, tag: "SSC JE 2016", explanation: "Slump test is the most common field test to measure the workability (consistency) of fresh concrete.<br>"},
    {id: 1133, question: "Le-Chatelier's method can be used to determine:", options: ["Fineness of cement", "Fineness of aggregate", "Soundness of cement", "Compressive strength"], ans: 2, tag: "SSC JE 2016", explanation: "Le-Chatelier's apparatus is used to determine the soundness of cement (expansion due to free lime)."},
    {id: 1134, question: "According to IS 456, the approximate estimated flexural strength of concrete of grade M25 is:", options: ["3.5 MPa", "2.5 MPa", "4.5 MPa", "5.5 MPa"], ans: 0, tag: "SSC JE 2016", explanation: "Flexural strength (fcr) = 0.7 * âˆšfck. For M25: 0.7 * âˆš25 = 0.7 * 5 = 3.5 MPa."},
    {id: 1135, question: "The entrained air in concrete:", options: ["Increases workability", "Decreases workability", "Decreases resistance to weathering", "Increases strength"], ans: 0, tag: "SSC JE 2016", explanation: "Air entrainment acts like ball bearings, increasing workability and resistance to freezing/thawing, but slightly reduces strength."},
    {id: 1136, question: "The standard consistency of cement paste is defined as consistency which will permit a Vicat plunger to penetrate to a depth of:", options: ["33-35 mm from top", "33-35 mm from bottom", "40-45 mm from top", "5-7 mm from bottom"], ans: 3, tag: "SSC JE 2017", explanation: "Standard consistency permits Vicat plunger to penetrate to a depth of 33-35 mm from the TOP, or 5-7 mm from the BOTTOM. (Note: Check wording carefully, usually stated as 5-7mm from bottom)."},
    {id: 1137, question: "Fineness of cement is measured in the units of:", options: ["Volume / mass", "Mass / volume", "Area / mass", "Mass / area"], ans: 2, tag: "SSC JE 2017", explanation: "Fineness is expressed as specific surface area (cmÂ²/gm or mÂ²/kg), which is Area / Mass."},
    {id: 1138, question: "Consistency of concrete can be measured by:", options: ["Finness modulus", "Kelly ball test", "Viscosity meter", "None"], ans: 1, tag: "SSC JE 2017", explanation: "Kelly ball test is a simple field method for determining the consistency (workability) of fresh concrete."},
    {id: 1139, question: "Generally the strength of concrete is considered as:", options: ["Tensile strength", "Compressive strength", "Flexural strength", "Shear strength"], ans: 1, tag: "SSC JE 2017", explanation: "Concrete is strong in compression and weak in tension. Its 'grade' (e.g., M20) refers to its characteristic compressive strength."}
];

// --- APP LOGIC ---
const app = {
    currentQ: 0,
    activeList: [],
    answers: {},
    reviews: new Set(),
    timer: null,
    timeLeft: 7200,

    startTest: (mode) => {
        if (mode === 'bookmark') {
            const saved = JSON.parse(localStorage.getItem('cement_bookmarks') || '[]');
            if (saved.length === 0) return alert("No bookmarks found!");
            app.activeList = rawData.filter(q => saved.includes(q.id));
        } else {
            app.activeList = [...rawData];
        }
        
        app.currentQ = 0;
        app.answers = {};
        app.reviews = new Set();
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('test-screen').classList.add('active');
        app.loadQuestion();
        app.startTimer();
        app.updatePalette();
    },

    loadQuestion: () => {
        const q = app.activeList[app.currentQ];
        const area = document.getElementById('question-area');
        const isAns = app.answers[q.id] !== undefined;
        const userOpt = app.answers[q.id];
        const isBookmarked = (JSON.parse(localStorage.getItem('cement_bookmarks') || '[]')).includes(q.id);

        document.getElementById('bookmark-btn').classList.toggle('active', isBookmarked);

        area.innerHTML = `
            <div style="background:white; padding:15px; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.05);">
                <div class="q-header">
                    <span style="font-weight:bold; color:var(--primary);">Question ${app.currentQ + 1} / ${app.activeList.length}</span>
                    <span class="exam-tag">${q.tag}</span>
                </div>
                <div class="q-text">${q.question}</div>
                <ul class="options-list">
                    ${q.options.map((opt, i) => `
                        <li class="option-item ${isAns ? (i===q.ans ? 'correct' : (i===userOpt ? 'wrong' : 'disabled')) : ''}" 
                            onclick="app.handleAnswer(${i})">
                            <div class="option-circle">${['A','B','C','D'][i]}</div>
                            ${opt}
                        </li>
                    `).join('')}
                </ul>
                <div class="solution-box ${isAns ? 'visible' : ''}">
                    <div class="sol-title"><i class="fas fa-lightbulb"></i> SOLUTION</div>
                    <div class="sol-text">${q.explanation}</div>
                </div>
            </div>
        `;
        app.updatePalette();
    },

    handleAnswer: (optIdx) => {
        const qId = app.activeList[app.currentQ].id;
        if (app.answers[qId] !== undefined) return;
        app.answers[qId] = optIdx;
        app.loadQuestion();
    },

    nextQuestion: () => {
        if (app.currentQ < app.activeList.length - 1) {
            app.currentQ++;
            app.loadQuestion();
        }
    },

    prevQuestion: () => {
        if (app.currentQ > 0) {
            app.currentQ--;
            app.loadQuestion();
        }
    },

    markReview: () => {
        const qId = app.activeList[app.currentQ].id;
        if (app.reviews.has(qId)) app.reviews.delete(qId);
        else app.reviews.add(qId);
        app.updatePalette();
    },

    toggleBookmark: () => {
        const qId = app.activeList[app.currentQ].id;
        let bms = JSON.parse(localStorage.getItem('cement_bookmarks') || '[]');
        if (bms.includes(qId)) bms = bms.filter(id => id !== qId);
        else bms.push(qId);
        localStorage.setItem('cement_bookmarks', JSON.stringify(bms));
        app.loadQuestion();
    },

    updatePalette: () => {
        const grid = document.getElementById('grid-box');
        grid.innerHTML = app.activeList.map((q, i) => {
            let cls = 'grid-item';
            if (i === app.currentQ) cls += ' current';
            if (app.answers[q.id] !== undefined) cls += ' answered';
            else if (app.reviews.has(q.id)) cls += ' review';
            return `<div class="${cls}" onclick="app.jumpTo(${i})">${i + 1}</div>`;
        }).join('');
    },

    jumpTo: (idx) => {
        app.currentQ = idx;
        app.loadQuestion();
        if (window.innerWidth < 769) app.togglePalette();
    },

    togglePalette: () => {
        const drawer = document.getElementById('palette-drawer');
        const overlay = document.getElementById('overlay');
        if (drawer.style.right === '0px' || drawer.classList.contains('open')) {
            drawer.classList.remove('open');
            drawer.style.right = '-280px';
            overlay.classList.remove('active');
        } else {
            drawer.classList.add('open');
            drawer.style.right = '0px';
            overlay.classList.add('active');
        }
    },

    startTimer: () => {
        app.timer = setInterval(() => {
            app.timeLeft--;
            const h = Math.floor(app.timeLeft / 3600);
            const m = Math.floor((app.timeLeft % 3600) / 60);
            const s = app.timeLeft % 60;
            document.getElementById('timer').innerText = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if (app.timeLeft <= 0) app.submitTest();
        }, 1000);
    },

    submitTest: () => {
        clearInterval(app.timer);
        let correct = 0;
        app.activeList.forEach(q => {
            if (app.answers[q.id] === q.ans) correct++;
        });
        
        // Save History
        const hist = JSON.parse(localStorage.getItem('cement_history') || '[]');
        hist.unshift({
            date: new Date().toLocaleDateString(),
            score: correct,
            total: app.activeList.length
        });
        localStorage.setItem('cement_history', JSON.stringify(hist));

        // Show Result
        document.getElementById('test-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        document.getElementById('score-val').innerText = correct;
        document.getElementById('res-attempted').innerText = Object.keys(app.answers).length;
        document.getElementById('res-total').innerText = app.activeList.length;
        document.getElementById('res-accuracy').innerText = Math.round((correct / (Object.keys(app.answers).length || 1)) * 100) + '%';
    },

    exitTest: () => {
        if(confirm("Exit test? Progress will be lost.")) location.reload();
    },

    loadHistory: () => {
        const hist = JSON.parse(localStorage.getItem('cement_history') || '[]');
        document.getElementById('history-list').innerHTML = hist.length ? hist.map(h => 
            `<div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                <span>${h.date}</span>
                <strong>${h.score}/${h.total}</strong>
            </div>`
        ).join('') : '<p style="color:#999">No previous tests taken.</p>';
    }
};

// Init
app.loadHistory();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SSC JE Civil Mock Test</title>
    <style>
        :root {
            --primary: #007bff; /* Testbook Blue */
            --success: #00c853; /* Green */
            --danger: #d32f2f; /* Red */
            --warning: #ffc107; /* Orange */
            --purple: #9c27b0; /* Review */
            --bg-color: #f5f7fb;
            --text-color: #333;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg-color); color: var(--text-color); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- UTILITIES --- */
        .hidden { display: none !important; }
        .btn { border: none; outline: none; padding: 10px 15px; border-radius: 4px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,123,255,0.3); }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-danger-outline { background: transparent; border: 1px solid var(--danger); color: var(--danger); font-size: 12px; padding: 4px 10px; border-radius: 4px; }

        /* --- SCREENS --- */
        .screen { height: 100%; width: 100%; display: flex; flex-direction: column; background: var(--bg-color); }

        /* --- START SCREEN --- */
        .center-card-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .card { background: white; width: 100%; max-width: 400px; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); text-align: center; }
        .exam-icon { width: 60px; height: 60px; background: #e3f2fd; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 30px; }
        .info-grid { display: flex; justify-content: space-between; margin: 15px 0; border-bottom: 1px solid #eee; padding-bottom: 15px; font-size: 14px; color: #555; }
        .history-badge { margin-top: 15px; padding: 8px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 6px; font-size: 12px; color: #856404; display: none; }

        /* --- QUIZ HEADER --- */
        header { background: white; height: 60px; padding: 0 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.05); z-index: 10; }
        .timer-box { background: #f0f0f0; padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 14px; display: flex; align-items: center; gap: 5px; color: #333; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .menu-icon { font-size: 24px; cursor: pointer; background: none; border: none; padding: 0 5px; }

        /* --- QUESTION AREA --- */
        .quiz-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .meta-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .exam-tag { background: #e3f2fd; color: #1565c0; font-size: 10px; padding: 4px 8px; border-radius: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
        .q-number { font-size: 12px; color: #777; font-weight: 600; }
        .question-text { font-size: 16px; font-weight: 500; line-height: 1.5; margin-bottom: 20px; color: #222; }

        /* --- OPTIONS --- */
        .options-container { list-style: none; padding: 0; margin: 0; }
        .option-box { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px 15px; margin-bottom: 12px; display: flex; align-items: center; cursor: pointer; transition: 0.1s; -webkit-tap-highlight-color: rgba(0,0,0,0.05); }
        .opt-id { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #ccc; color: #666; font-size: 13px; font-weight: bold; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; }
        .opt-val { font-size: 15px; color: #444; }

        /* Option States */
        .option-box.correct { background: #e8f5e9; border-color: var(--success); }
        .option-box.correct .opt-id { background: var(--success); border-color: var(--success); color: white; }
        
        .option-box.wrong { background: #ffebee; border-color: var(--danger); }
        .option-box.wrong .opt-id { background: var(--danger); border-color: var(--danger); color: white; }
        
        .disabled { pointer-events: none; }

        /* --- SOLUTION --- */
        .solution-card { margin-top: 20px; background: white; border-left: 5px solid var(--primary); border-radius: 4px; padding: 15px; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.05); animation: fadeUp 0.3s ease; }
        .sol-label { font-weight: bold; color: var(--primary); margin-bottom: 8px; display: block; font-size: 14px; }
        .sol-desc { font-size: 14px; color: #555; line-height: 1.6; white-space: pre-wrap; }

        /* --- FOOTER NAV --- */
        .footer-bar { position: fixed; bottom: 0; width: 100%; height: 60px; background: white; border-top: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; z-index: 20; }
        .action-group { display: flex; gap: 20px; }
        .icon-btn { background: none; border: none; color: #666; display: flex; flex-direction: column; align-items: center; gap: 2px; cursor: pointer; font-size: 10px; font-weight: 500; }
        .icon-btn span { font-size: 18px; }
        .bookmark-active { color: var(--primary) !important; }

        /* --- PALETTE DRAWER --- */
        .drawer-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 50; display: none; }
        .right-drawer { position: fixed; top: 0; right: -85%; width: 85%; max-width: 320px; height: 100%; background: white; z-index: 51; transition: right 0.3s ease; display: flex; flex-direction: column; }
        .drawer-head { height: 60px; border-bottom: 1px solid #eee; display: flex; align-items: center; padding: 0 15px; font-weight: bold; justify-content: space-between; background: #fafafa; }
        .palette-grid { padding: 15px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; overflow-y: auto; flex: 1; }
        .p-node { height: 40px; width: 40px; border-radius: 50%; background: #f0f0f0; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; cursor: pointer; }
        
        /* Palette Colors */
        .p-node.answered { background: var(--success); color: white; border-color: var(--success); }
        .p-node.visited { background: #d32f2f; color: white; border-color: #d32f2f; } /* Visited/Not Answered */
        .p-node.review { background: var(--purple); color: white; border-color: var(--purple); }
        .p-node.current { border: 2px solid var(--primary); transform: scale(1.1); box-shadow: 0 0 5px rgba(0,0,0,0.2); }

        .palette-legend { padding: 10px; font-size: 11px; border-top: 1px solid #eee; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; background: #fafafa; }
        .legend-row { display: flex; align-items: center; gap: 6px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }

        /* --- RESULT SCREEN --- */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin: 20px 0; }
        .stat-box { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ccc; text-align: left; }

        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <div class="center-card-container">
            <div class="card">
                <div class="exam-icon">üèóÔ∏è</div>
                <h2 style="margin: 0 0 10px 0;">SSC JE Civil: Cement</h2>
                <p style="color:#666; font-size:14px; margin-bottom:20px;">Questions 1078 to 1108</p>
                
                <div class="info-grid">
                    <span>‚è±Ô∏è <b>120 Mins</b></span>
                    <span>‚ùì <b>31 Qs</b></span>
                </div>

                <div id="last-score-box" class="history-badge"></div>

                <button class="btn btn-primary" style="width:100%; margin-top:10px; padding:12px; font-size:16px;" onclick="app.startTest()">START NEW TEST</button>
                
                <button class="btn btn-outline" style="width:100%; margin-top:15px; border-radius:25px; border-width:2px; font-weight:bold;" onclick="app.startBookmarkTest()">
                    üìÇ Practice Bookmarks (Test Mode)
                </button>
                <div style="font-size:11px; color:#999; margin-top:5px;">(Re-attempt saved questions in exam format)</div>
            </div>
        </div>
    </div>

    <div id="quiz-screen" class="screen hidden">
        <header>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="btn-danger-outline" onclick="app.exitTest()">Exit</button>
                <div class="timer-box">
                    <span>‚è≥</span> <span id="timer">02:00:00</span>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-primary" style="font-size:13px; padding:6px 15px;" onclick="app.submitTest()">Submit</button>
                <button class="menu-icon" onclick="app.togglePalette()">‚ò∞</button>
            </div>
        </header>

        <div id="quiz-body" class="quiz-content">
            </div>

        <div class="footer-bar">
            <div class="action-group">
                <button class="icon-btn" onclick="app.markReview()">
                    <span>üëÅÔ∏è</span> Review
                </button>
                <button id="bm-btn" class="icon-btn" onclick="app.toggleBookmark()">
                    <span>üîñ</span> Save
                </button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-outline" onclick="app.prevQ()">Previous</button>
                <button class="btn btn-primary" onclick="app.nextQ()">Next</button>
            </div>
        </div>
    </div>

    <div id="drawer-backdrop" class="drawer-backdrop" onclick="app.togglePalette()"></div>
    <div id="palette-drawer" class="right-drawer">
        <div class="drawer-head">
            <span>Question Palette</span>
            <span onclick="app.togglePalette()" style="cursor:pointer; padding:10px;">‚úï</span>
        </div>
        <div id="palette-grid" class="palette-grid">
            </div>
        <div class="palette-legend">
            <div class="legend-row"><div class="dot" style="background:var(--success)"></div> Answered</div>
            <div class="legend-row"><div class="dot" style="background:var(--danger)"></div> Visited</div>
            <div class="legend-row"><div class="dot" style="background:var(--purple)"></div> Review</div>
            <div class="legend-row"><div class="dot" style="background:#f0f0f0; border:1px solid #ccc"></div> Skipped</div>
        </div>
    </div>

    <div id="result-screen" class="screen hidden">
        <div class="center-card-container">
            <div class="card">
                <div class="exam-icon" style="background: #e8f5e9; color: var(--success);">üèÜ</div>
                <h2>Test Summary</h2>
                <div class="stats-grid">
                    <div class="stat-box" style="border-color: var(--success);">
                        <div style="font-size: 24px; font-weight: bold;" id="res-score">0</div>
                        <div style="font-size:12px; color:#555;">Score</div>
                    </div>
                    <div class="stat-box" style="border-color: var(--primary);">
                        <div style="font-size: 24px; font-weight: bold;" id="res-acc">0%</div>
                        <div style="font-size:12px; color:#555;">Accuracy</div>
                    </div>
                </div>
                <p id="res-msg" style="margin-bottom:20px; font-weight:500; color:#444;"></p>
                <button class="btn btn-primary" style="width:100%" onclick="location.reload()">Back to Home</button>
            </div>
        </div>
    </div>

<script>
    // --- QUESTION DATABASE (1078-1108) ---
    const DB = [
        { id: 1078, tag: "SSC JE 2018", text: "Gypsum is added in the manufacture of Portland cement in order to:", options: ["decrease the burning temperature", "decrease the grinding time", "lengthen the setting time", "shorten the setting time"], ans: 2, sol: "Gypsum (Calcium Sulphate) acts as a retarder. It reacts with C3A (Tricalcium Aluminate) to form Ettringite, which prevents 'Flash Set' and allows sufficient time for mixing and placing concrete." },
        { id: 1079, tag: "RRB JE 2019", text: "Which type of cement is used for mass concreting work like dams?", options: ["Rapid Hardening Cement", "Low Heat Cement", "Quick Setting Cement", "High Alumina Cement"], ans: 1, sol: "Low Heat Cement (IS 12600) is used for mass concreting to reduce the heat of hydration, thereby preventing thermal cracks. It contains lower C3S and C3A." },
        { id: 1080, tag: "SSC JE 2017", text: "Early attainment of strength in rapid hardening cement is mainly due to:", options: ["Gypsum", "Finer grinding", "Tricalcium silicate", "Tricalcium aluminate"], ans: 1, sol: "Rapid Hardening Cement attains early strength due to finer grinding (larger surface area for hydration) and a higher percentage of C3S compared to OPC." },
        { id: 1081, tag: "SSC JE 2016", text: "Raw materials of white cement consist of:", options: ["Limestone and china clay", "Powdered quartzite", "Fly ash and burnt clay", "Argillaceous materials"], ans: 0, sol: "White cement uses pure Limestone (chalk) and China Clay (Kaolin) which are free from Iron Oxide (Fe2O3) and Manganese, as these oxides are responsible for the grey colour." },
        { id: 1082, tag: "SSC JE 2018", text: "In ordinary Portland cement, the quantity of tetra calcium alumino ferrite (C4AF) is approximately:", options: ["8 to 10%", "2 to 5%", "Greater than 18%", "5 to 8%"], ans: 0, sol: "Typical Bogue's Composition:\nC3S: 30-50%\nC2S: 20-45%\nC3A: 8-12%\nC4AF: 6-10% (Often 8-10% in exam options)." },
        { id: 1083, tag: "DDA JE 2018", text: "Which of the following should be added to increase the setting time of cement?", options: ["Calcium hydroxide", "Gypsum", "Red oxide of mercury", "Sodium"], ans: 1, sol: "Gypsum is the standard retarder added to clinker during grinding to increase the initial setting time." },
        { id: 1084, tag: "SSC JE 2019", text: "Cement is obtained by burning a mixture of which of the following materials?", options: ["Calcareous materials", "Argillaceous materials", "Siliceous materials", "All of the above"], ans: 3, sol: "Cement manufacture requires Calcareous (Lime-rich) and Argillaceous (Clay/Silica/Alumina-rich) materials burned at ~1450¬∞C." },
        { id: 1085, tag: "LMRC JE 2019", text: "For the construction of structures in sea water, the cement generally preferred is:", options: ["Portland Pozzolana Cement", "Quick setting cement", "Low Heat Cement", "Rapid Hardening Cement"], ans: 0, sol: "Portland Pozzolana Cement (PPC) or Sulphate Resisting Cement is preferred in marine environments due to better resistance against sulphate attack and lower permeability." },
        { id: 1086, tag: "SSC JE 2015", text: "The heat of hydration of cement can be reduced by:", options: ["Reducing C3A and C3S", "Increasing C3A and C3S", "Increasing fineness", "Both A and C"], ans: 0, sol: "C3A and C3S are the primary heat-generating compounds. Reducing their proportion (and increasing C2S) creates Low Heat Cement." },
        { id: 1087, tag: "SSC JE 2018", text: "The main constituents of fly-ash are:", options: ["Aluminium oxide", "Silica", "Ferrous oxide", "All of the above"], ans: 3, sol: "Fly ash is a pozzolanic material containing Silica (SiO2), Alumina (Al2O3), Iron oxide (Fe2O3), and Lime (CaO)." },
        { id: 1088, tag: "IS Code", text: "As per IS 8112:2013, the minimum initial setting time for 43 Grade OPC is:", options: ["30 minutes", "60 minutes", "600 minutes", "10 minutes"], ans: 0, sol: "For all grades of OPC (33, 43, 53), the minimum initial setting time is 30 minutes, and the maximum final setting time is 600 minutes (10 hours)." },
        { id: 1089, tag: "SSC JE 2014", text: "The Bogue compound responsible for the flash set and maximum heat of hydration initially is:", options: ["C4AF", "C2S", "C3A", "C3S"], ans: 2, sol: "Tricalcium Aluminate (C3A) reacts immediately with water, generating high heat and causing flash set if gypsum is not present." },
        { id: 1090, tag: "SSC JE 2016", text: "Soundness of cement due to free lime is tested using:", options: ["Specific gravity bottle", "Le Chatelier apparatus", "Vicat apparatus", "Blaine's apparatus"], ans: 1, sol: "Le Chatelier apparatus tests soundness due to free lime. The Autoclave test detects soundness due to both lime and magnesia." },
        { id: 1091, tag: "SSC JE 2017", text: "If P is standard consistency, water required for Initial Setting Time test is:", options: ["0.75 P", "0.85 P", "0.78 P", "0.60 P"], ans: 1, sol: "Water requirements:\nSetting Time: 0.85P\nSoundness: 0.78P\nCompressive Strength: (P/4 + 3)%" },
        { id: 1092, tag: "SSC JE 2018", text: "Excess gypsum content in cement leads to:", options: ["Faster setting", "Higher strength", "Expansion and disruption", "None of these"], ans: 2, sol: "Excess gypsum leads to the formation of expanded ettringite after the paste has hardened, causing expansion, cracking, and disruption (unsoundness)." },
        { id: 1093, tag: "SSC JE 2019", text: "The diameter of the Vicat plunger used for normal consistency test is:", options: ["10 mm", "1 mm", "5 mm", "40 mm"], ans: 0, sol: "For the Standard Consistency test, a plunger of 10 mm diameter and 50 mm length is used." },
        { id: 1094, tag: "Practical", text: "Adulterated cement can be identified in the field because:", options: ["It is smooth to touch", "It changes colour when heated", "It floats on water", "It is greenish grey"], ans: 1, sol: "Pure cement retains its colour upon heating, whereas adulterated cement often changes colour when heated on a steel plate." },
        { id: 1095, tag: "SSC JE 2013", text: "The specific surface area (Blaine's) of OPC should not be less than:", options: ["225 m¬≤/kg", "300 m¬≤/kg", "100 m¬≤/kg", "325 m¬≤/kg"], ans: 0, sol: "IS 8112 (43 Grade OPC) specifies a minimum fineness (specific surface area) of 225 m¬≤/kg." },
        { id: 1096, tag: "SSC JE 2018", text: "The approximate specific gravity of Ordinary Portland Cement is:", options: ["2.50", "3.15", "2.65", "1.44"], ans: 1, sol: "The specific gravity of OPC is generally taken as 3.15. (For PPC it is slightly lower, around 3.0)." },
        { id: 1097, tag: "Misc", text: "Silica Fume is primarily used in concrete to:", options: ["Retard setting", "Increase permeability", "Increase strength and durability", "Reduce heat"], ans: 2, sol: "Silica fume is a very fine pozzolan used in High Strength Concrete to fill voids (micro-filler effect) and react with lime, significantly increasing strength and durability." },
        { id: 1098, tag: "SSC JE 2016", text: "Which method is NOT used to determine fineness of cement?", options: ["Sieve Analysis", "Air Permeability", "Wagner Turbidimeter", "Vicat Apparatus"], ans: 3, sol: "Vicat Apparatus is used for Consistency and Setting Time. Fineness is tested by Sieve (90 micron), Blaine's Air Permeability, or Wagner Turbidimeter." },
        { id: 1099, tag: "SSC JE 2017", text: "Carbonation of concrete is the reaction between:", options: ["Silica and CO2", "Calcium Hydroxide and CO2", "Iron and Oxygen", "C3A and Water"], ans: 1, sol: "Carbonation is the reaction of atmospheric CO2 with Ca(OH)2 in the cement paste to form Calcium Carbonate, lowering the pH and risking steel corrosion." },
        { id: 1100, tag: "Advanced", text: "According to Powers, the strength of concrete is a function of:", options: ["Gel/Space ratio", "Water/Cement ratio", "Aggregate size", "Sand content"], ans: 0, sol: "While W/C ratio is common, Powers established that strength is fundamentally a function of the Gel/Space ratio (volume of gel to the space available for it)." },
        { id: 1101, tag: "Basic", text: "The chemical reaction between cement and water is known as:", options: ["Chlorination", "Hydration", "Carbonation", "Calcination"], ans: 1, sol: "The reaction is called Hydration. It is an exothermic reaction (releases heat)." },
        { id: 1102, tag: "SSC JE 2012", text: "The minimum water content required for complete chemical hydration of cement is approximately:", options: ["23%", "38%", "15%", "50%"], ans: 0, sol: "Approx 23% by weight is required for chemical combination (bound water). An additional ~15% is needed to fill gel pores, making the total minimum for full hydration ~38%." },
        { id: 1103, tag: "SSC JE 2015", text: "Sulphate Resisting Cement (IS 12330) has a low content of:", options: ["C3S", "C2S", "C3A", "C4AF"], ans: 2, sol: "To resist sulphate attack, the C3A content is restricted to less than 5% because C3A reacts with sulphates to form expansive Ettringite." },
        { id: 1104, tag: "Site Engg", text: "The water-cement ratio primarily governs which property of hardened concrete?", options: ["Workability", "Strength", "Setting time", "Color"], ans: 1, sol: "According to Abram's Law, the compressive strength of concrete is inversely proportional to the water-cement ratio, provided the mix is workable." },
        { id: 1105, tag: "SSC JE 2018", text: "Portland Slag Cement is produced by inter-grinding clinker with:", options: ["Fly ash", "Granulated Blast Furnace Slag", "Burnt Clay", "Rice Husk"], ans: 1, sol: "Portland Slag Cement (PSC) is made by grinding OPC clinker, gypsum, and Granulated Blast Furnace Slag (a by-product of the steel industry)." },
        { id: 1106, tag: "Geology", text: "Which of the following minerals has the lowest hardness (Mohs scale 1)?", options: ["Gypsum", "Talc", "Calcite", "Quartz"], ans: 1, sol: "Talc has a hardness of 1. Gypsum is 2, Calcite is 3, Diamond is 10." },
        { id: 1107, tag: "Theory", text: "Water that is chemically combined with cement during hydration is called:", options: ["Free water", "Non-evaporable water", "Capillary water", "Hygroscopic water"], ans: 1, sol: "Chemically combined water is part of the solid structure and cannot be removed by drying at 105¬∞C, hence called non-evaporable water." },
        { id: 1108, tag: "IS Code", text: "The percentage of slag in Portland Slag Cement (PSC) varies between:", options: ["10-20%", "25-65%", "70-90%", "5-10%"], ans: 1, sol: "As per IS 455, the slag constituent in Portland Slag Cement typically ranges from 25% to 65%." }
    ];

    // --- MAIN LOGIC ---
    const app = {
        currentIdx: 0,
        activeDB: [], // Will hold either full DB or Bookmarks
        answers: {}, 
        visited: new Set(),
        reviews: new Set(),
        bookmarks: new Set(JSON.parse(localStorage.getItem('ssc_bookmarks')) || []),
        timerRef: null,
        timeLeft: 7200, 
        isBookmarkMode: false,

        init: function() {
            // Load Last Score
            const lastScore = localStorage.getItem('ssc_last_score');
            if(lastScore) {
                const box = document.getElementById('last-score-box');
                box.style.display = 'block';
                box.innerText = `üìú Last Score: ${lastScore}`;
            }
        },

        // 1. Start Standard Test
        startTest: function() {
            this.activeDB = DB; 
            this.isBookmarkMode = false;
            this.resetSession(7200); // 2 hours
        },

        // 2. Start Bookmark Practice Test
        startBookmarkTest: function() {
            if(this.bookmarks.size === 0) {
                alert("No bookmarks saved yet! Start a main test and save some questions first.");
                return;
            }
            // Filter DB for bookmarked IDs
            this.activeDB = DB.filter(q => this.bookmarks.has(q.id));
            this.isBookmarkMode = true;
            // Time: 1 min per question for practice
            this.resetSession(this.activeDB.length * 60); 
        },

        resetSession: function(timeSeconds) {
            this.currentIdx = 0;
            this.answers = {};
            this.visited = new Set();
            this.reviews = new Set();
            this.timeLeft = timeSeconds;

            // UI Switch
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            document.getElementById('result-screen').classList.add('hidden');

            clearInterval(this.timerRef);
            this.startTimer();
            this.loadQuestion(0);
        },

        startTimer: function() {
            const display = document.getElementById('timer');
            this.timerRef = setInterval(() => {
                this.timeLeft--;
                if(this.timeLeft <= 0) {
                    this.submitTest();
                }
                const h = Math.floor(this.timeLeft / 3600);
                const m = Math.floor((this.timeLeft % 3600) / 60);
                const s = this.timeLeft % 60;
                display.innerText = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            }, 1000);
        },

        loadQuestion: function(idx) {
            this.currentIdx = idx;
            const q = this.activeDB[idx];
            this.visited.add(q.id);

            const container = document.getElementById('quiz-body');
            const isAns = this.answers.hasOwnProperty(q.id);
            const userAns = this.answers[q.id];

            // Render HTML
            let html = `
                <div class="meta-row">
                    <span class="exam-tag">${q.tag}</span>
                    <span class="q-number">Q${idx+1} / ${this.activeDB.length}</span>
                </div>
                <div class="question-text">Q${q.id}. ${q.text}</div>
                <ul class="options-container">
            `;

            q.options.forEach((opt, i) => {
                let cls = 'option-box';
                if(isAns) {
                    cls += ' disabled';
                    if(i === q.ans) cls += ' correct';
                    else if(i === userAns) cls += ' wrong';
                }
                html += `
                    <li class="${cls}" onclick="app.checkAnswer(${q.id}, ${i})">
                        <div class="opt-id">${String.fromCharCode(65+i)}</div>
                        <div class="opt-val">${opt}</div>
                    </li>
                `;
            });
            html += `</ul>`;

            // Solution Block
            html += `
                <div class="solution-card" style="display: ${isAns ? 'block' : 'none'}">
                    <span class="sol-label">üí° Detailed Solution:</span>
                    <div class="sol-desc">${q.sol}</div>
                </div>
            `;

            container.innerHTML = html;
            this.updateButtons();
        },

        checkAnswer: function(qId, optIdx) {
            if(this.answers.hasOwnProperty(qId)) return;
            this.answers[qId] = optIdx;
            this.loadQuestion(this.currentIdx);
        },

        nextQ: function() {
            if(this.currentIdx < this.activeDB.length - 1) this.loadQuestion(this.currentIdx + 1);
        },

        prevQ: function() {
            if(this.currentIdx > 0) this.loadQuestion(this.currentIdx - 1);
        },

        togglePalette: function() {
            const drawer = document.getElementById('palette-drawer');
            const overlay = document.getElementById('drawer-backdrop');
            
            if(drawer.style.right === '0px') {
                drawer.style.right = '-85%';
                overlay.style.display = 'none';
            } else {
                this.renderPaletteGrid();
                drawer.style.right = '0px';
                overlay.style.display = 'block';
            }
        },

        renderPaletteGrid: function() {
            const grid = document.getElementById('palette-grid');
            grid.innerHTML = '';
            
            this.activeDB.forEach((q, i) => {
                const node = document.createElement('div');
                node.className = 'p-node';
                node.innerText = i + 1;
                
                if(i === this.currentIdx) node.classList.add('current');
                else if(this.reviews.has(q.id)) node.classList.add('review');
                else if(this.answers.hasOwnProperty(q.id)) node.classList.add('answered');
                else if(this.visited.has(q.id)) node.classList.add('visited');

                node.onclick = () => {
                    this.loadQuestion(i);
                    this.togglePalette();
                };
                grid.appendChild(node);
            });
        },

        markReview: function() {
            const qId = this.activeDB[this.currentIdx].id;
            if(this.reviews.has(qId)) this.reviews.delete(qId);
            else this.reviews.add(qId);
            this.togglePalette(); this.togglePalette(); // Hack to refresh UI
        },

        toggleBookmark: function() {
            const qId = this.activeDB[this.currentIdx].id;
            const btn = document.getElementById('bm-btn');
            
            if(this.bookmarks.has(qId)) {
                this.bookmarks.delete(qId);
                btn.classList.remove('bookmark-active');
            } else {
                this.bookmarks.add(qId);
                btn.classList.add('bookmark-active');
            }
            localStorage.setItem('ssc_bookmarks', JSON.stringify([...this.bookmarks]));
        },

        updateButtons: function() {
            const qId = this.activeDB[this.currentIdx].id;
            const btn = document.getElementById('bm-btn');
            if(this.bookmarks.has(qId)) btn.classList.add('bookmark-active');
            else btn.classList.remove('bookmark-active');
        },

        exitTest: function() {
            if(confirm("Are you sure you want to exit?")) {
                this.submitTest();
            }
        },

        submitTest: function() {
            clearInterval(this.timerRef);
            let score = 0;
            this.activeDB.forEach(q => {
                if(this.answers[q.id] === q.ans) score++;
            });
            
            const total = this.activeDB.length;
            const accuracy = total > 0 ? Math.round((score / Object.keys(this.answers).length || 1) * 100) : 0;
            const finalAcc = isNaN(accuracy) ? 0 : accuracy;

            // Only Save score if Main Test
            if(!this.isBookmarkMode) {
                localStorage.setItem('ssc_last_score', `${score}/${total}`);
            }

            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            document.getElementById('res-score').innerText = `${score} / ${total}`;
            document.getElementById('res-acc').innerText = `${finalAcc}%`;

            let msg = this.isBookmarkMode ? "Bookmark Practice Complete! üìö" : "Test Submitted Successfully! üéâ";
            document.getElementById('res-msg').innerText = msg;
        }
    };

    window.onload = () => app.init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SSC JE/Civil Mock Test</title>
    <style>
        :root {
            --primary: #007bff; /* Testbook Blue */
            --success: #00c853; /* Green */
            --danger: #d32f2f; /* Red */
            --warning: #ffc107; /* Yellow/Orange */
            --purple: #9c27b0; /* Mark for Review */
            --gray: #e0e0e0;
            --text: #333;
            --bg: #f5f7fb;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; }

        /* --- SCREENS --- */
        .screen { display: none; height: 100%; width: 100%; flex-direction: column; }
        .active { display: flex; }

        /* --- HEADER --- */
        header { background: #fff; padding: 10px 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; z-index: 10; height: 60px; }
        .timer-box { font-weight: bold; color: var(--text); background: #f0f0f0; padding: 5px 10px; border-radius: 4px; display: flex; align-items: center; gap: 5px; }
        .btn-submit { background: var(--success); color: white; border: none; padding: 6px 15px; border-radius: 4px; font-weight: bold; font-size: 14px; }
        .btn-exit { background: transparent; border: 1px solid #d32f2f; color: #d32f2f; padding: 5px 10px; border-radius: 4px; font-size: 12px; }

        /* --- QUESTION AREA --- */
        #quiz-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .exam-tag { display: inline-block; background: #e3f2fd; color: #1565c0; font-size: 11px; padding: 2px 8px; border-radius: 10px; margin-bottom: 8px; font-weight: 600; }
        .q-text { font-size: 16px; font-weight: 500; margin-bottom: 15px; line-height: 1.4; }
        
        .options-list { list-style: none; padding: 0; }
        .option-item { background: #fff; border: 1px solid #ddd; padding: 12px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; transition: 0.2s; }
        .option-circle { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #aaa; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: #666; }
        
        /* Option States */
        .option-item.correct { border-color: var(--success); background: #e8f5e9; }
        .option-item.correct .option-circle { border-color: var(--success); background: var(--success); color: white; }
        
        .option-item.wrong { border-color: var(--danger); background: #ffebee; }
        .option-item.wrong .option-circle { border-color: var(--danger); background: var(--danger); color: white; }
        
        .disabled { pointer-events: none; opacity: 0.9; }

        /* --- SOLUTION BOX --- */
        .solution-box { display: none; margin-top: 15px; background: #fff; border-left: 4px solid var(--primary); padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .solution-title { font-weight: bold; color: var(--primary); margin-bottom: 5px; display: block; }
        .solution-text { font-size: 14px; color: #444; white-space: pre-wrap; line-height: 1.5; }

        /* --- FOOTER NAV --- */
        .footer-nav { position: fixed; bottom: 0; width: 100%; background: #fff; border-top: 1px solid #eee; padding: 10px; display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .nav-btn { background: #fff; border: 1px solid #ccc; padding: 8px 15px; border-radius: 4px; font-weight: 600; color: #555; }
        .nav-btn.primary { background: var(--primary); color: white; border: none; }
        .action-icons { display: flex; gap: 15px; }
        .icon-btn { font-size: 20px; color: #666; background: none; border: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 10px; gap: 2px; }
        .icon-btn span { font-size: 18px; }

        /* --- PALETTE DRAWER --- */
        #palette-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 20; }
        #palette-drawer { position: fixed; top: 60px; right: -80%; width: 80%; height: calc(100% - 60px); background: #fff; z-index: 21; transition: 0.3s; display: flex; flex-direction: column; }
        .palette-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; overflow-y: auto; }
        .p-item { height: 40px; width: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 14px; font-weight: bold; background: #f0f0f0; border: 1px solid #ccc; cursor: pointer; }
        
        /* Palette Colors */
        .p-item.answered { background: var(--success); color: white; border-color: var(--success); }
        .p-item.visited { background: var(--danger); color: white; border-color: var(--danger); } /* Technically "Not Answered" in standard format, usually red */
        .p-item.review { background: var(--purple); color: white; border-color: var(--purple); }
        .p-item.current { border: 2px solid var(--primary); transform: scale(1.1); }

        .palette-legend { padding: 10px; border-top: 1px solid #eee; font-size: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }

        /* --- START & RESULT SCREEN --- */
        .center-box { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; }
        .start-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .start-btn { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 18px; font-weight: bold; margin-top: 20px; width: 100%; cursor: pointer; }
        .history-btn { margin-top: 15px; background: transparent; color: var(--primary); border: 1px solid var(--primary); padding: 8px 20px; border-radius: 20px; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin: 20px 0; }
        .stat-box { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ccc; }
        
        /* BOOKMARKS */
        .bookmark-active { color: var(--primary) !important; }

    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <div class="center-box">
            <div class="start-card">
                <img src="https://cdn-icons-png.flaticon.com/512/2983/2983664.png" alt="Quiz" style="width: 60px; margin-bottom: 15px;">
                <h2>SSC JE Civil: Cement</h2>
                <p>Questions 1078 to 1108</p>
                <div style="text-align: left; margin: 15px 0; font-size: 14px; color: #555;">
                    <p>‚úÖ <b>Time:</b> 120 Minutes</p>
                    <p>‚úÖ <b>Questions:</b> 31</p>
                    <p>‚úÖ <b>Solutions:</b> Instant (Immediate)</p>
                </div>
                <button class="start-btn" onclick="startTest()">Start Test</button>
                <button class="history-btn" onclick="showBookmarks()">üìÇ View Bookmarks</button>
                <div id="last-score" style="margin-top: 10px; font-size: 12px; color: #777;"></div>
            </div>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <header>
            <div style="display:flex; align-items:center; gap:10px;">
                <button onclick="exitTest()" class="btn-exit">Exit</button>
                <div class="timer-box">
                    <span>‚è≥</span> <span id="timer">02:00:00</span>
                </div>
            </div>
            <div>
                <button class="icon-btn" onclick="togglePalette()" style="display:inline-block; margin-right:10px;">
                    <span style="font-size:20px;">‚ò∞</span>
                </button>
                <button class="btn-submit" onclick="submitTest()">Submit</button>
            </div>
        </header>

        <div id="quiz-content">
            </div>

        <div class="footer-nav">
            <div class="action-icons">
                <button class="icon-btn" onclick="markReview()">
                    <span>üëÅÔ∏è</span> Review
                </button>
                <button class="icon-btn" id="bookmark-btn" onclick="toggleBookmark()">
                    <span>üîñ</span> Save
                </button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="nav-btn" onclick="prevQuestion()">Previous</button>
                <button class="nav-btn primary" onclick="nextQuestion()">Next</button>
            </div>
        </div>

        <div id="palette-overlay" onclick="togglePalette()"></div>
        <div id="palette-drawer">
            <div style="padding:15px; border-bottom:1px solid #eee; font-weight:bold;">Question Palette</div>
            <div class="palette-grid" id="palette-grid">
                </div>
            <div class="palette-legend">
                <div class="legend-item"><div class="dot" style="background:var(--success)"></div> Answered</div>
                <div class="legend-item"><div class="dot" style="background:var(--danger)"></div> Visited</div>
                <div class="legend-item"><div class="dot" style="background:var(--purple)"></div> Review</div>
                <div class="legend-item"><div class="dot" style="background:#f0f0f0; border:1px solid #ccc"></div> Skipped</div>
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <div class="center-box">
            <div class="start-card">
                <h2>Test Summary</h2>
                <div class="stat-grid">
                    <div class="stat-box" style="border-color: var(--success);">
                        <div style="font-size: 24px; font-weight: bold;" id="res-score">0</div>
                        <div>Score</div>
                    </div>
                    <div class="stat-box" style="border-color: var(--primary);">
                        <div style="font-size: 24px; font-weight: bold;" id="res-accuracy">0%</div>
                        <div>Accuracy</div>
                    </div>
                </div>
                <p id="res-msg"></p>
                <button class="start-btn" onclick="location.reload()">Back to Home</button>
            </div>
        </div>
    </div>

    <div id="bookmark-screen" class="screen" style="background:white;">
        <header>
            <button class="btn-exit" onclick="location.reload()">‚Üê Back</button>
            <span style="font-weight:bold;">Saved Questions</span>
            <div style="width:50px;"></div>
        </header>
        <div id="bookmark-list" style="padding:15px; overflow-y:auto;"></div>
    </div>

<script>
    // --- DATA: Questions 1078 to 1108 ---
    const questions = [
        {
            id: 1078,
            text: "Gypsum is added in the manufacture of Portland cement in order to",
            options: ["decrease the burning temperature", "decrease the grinding time", "lengthen the setting time of cement", "shorten the setting time of cement"],
            ans: 2, // c
            tag: "RRB JE CBT-II 28-08-2019",
            sol: "Gypsum (CaSO4.2H2O) is added (2-3%) to clinker during grinding to prevent flash set. It reacts with C3A to form Ettringite, which coats C3A particles and retards hydration, thus lengthening the setting time."
        },
        {
            id: 1079,
            text: "Which type of following cement is used for mass concreting work?",
            options: ["Rapid Hardening Cement", "Low heat cement", "Quick setting cement", "High Alumina Cement"],
            ans: 1, // b
            tag: "Mizoram PSC JE 2018",
            sol: "Low Heat Cement (IS: 12600) is used for mass concreting (dams, bridge abutments) to reduce the heat of hydration and prevent thermal cracking. It has low C3S and C3A and high C2S."
        },
        {
            id: 1080,
            text: "Early attainment of strength in rapid hardening cement is mainly due to ................",
            options: ["gypsum", "finer grinding", "tricalcium silicate", "tricalcium aluminate"],
            ans: 1, // b
            tag: "MH PWD 2016",
            sol: "Rapid Hardening Cement is similar to OPC but with higher C3S content and **finer grinding**. Finer grinding increases surface area for hydration, leading to higher early strength."
        },
        {
            id: 1081,
            text: "Raw materials of white cement consist of :",
            options: ["lime stone and china clay", "powdered quartzite", "fly ash and burnt clay", "powdered argillaceous materials"],
            ans: 0, // a
            tag: "GAIL 2018",
            sol: "White cement is made from pure limestone (chalk) and china clay (kaolin) which are free from iron oxide (Fe2O3) and Manganese, which give grey colour."
        },
        {
            id: 1082,
            text: "In ordinary Portland cement, quantity of tetra calcium alumino ferrite will be :",
            options: ["between 8 to 10%", "between 2 to 5%", "greater than 18%", "between 5 to 8%"],
            ans: 0, // a
            tag: "UPRVUNL JE 2016",
            sol: "Approximate oxide composition Bogue's Compounds:\nC3S: 30-50%\nC2S: 20-45%\nC3A: 8-12%\nC4AF: 6-10% (Often cited as 8-10% in exams)"
        },
        {
            id: 1083,
            text: "Which of the following should be added to increase the setting time of cement?",
            options: ["Calcium hydroxide", "Gypsum", "Red oxide of mercury", "Sodium"],
            ans: 1, // b
            tag: "GAIL 2018",
            sol: "Gypsum is a retarder. It is added to increase the initial setting time so that concrete can be placed and compacted before it sets."
        },
        {
            id: 1084,
            text: "Cement is obtained by burning a mixture of which of the following material (s) in definite properties?",
            options: ["Calcareous materials containing lime", "Argillaceous material containing alumina", "Siliceous materials containing silica", "All of the given options"],
            ans: 3, // d
            tag: "GAIL 2018",
            sol: "Cement consists of Calcareous compounds (Ca, Mg) and Argillaceous compounds (Si, Al, Oxides). All listed options are correct raw materials."
        },
        {
            id: 1085,
            text: "In the arid western region of India ______",
            options: ["white cement", "quick setting cement", "pozzolana cement", "sulphate resisting cement"],
            ans: 2, // c
            tag: "GAIL 2018",
            sol: "In arid regions, heat evolution can be an issue. Portland Pozzolana Cement (PPC) has low heat evolution and is suitable for dams and high temp places."
        },
        {
            id: 1086,
            text: "The heat of hydration of cement can be reduced by",
            options: ["reduced the proportions of C3A and C3S", "increasing the proportions of C3A and C3S", "increasing the fineness of cement", "both (a) and (c)"],
            ans: 0, // a
            tag: "NBCC JE 2018",
            sol: "C3A and C3S are responsible for early heat generation. Reducing them (and increasing C2S) creates Low Heat Cement."
        },
        {
            id: 1087,
            text: "The main constituents or chemical composition of fly-ash, is/are",
            options: ["aluminium oxide", "silica", "ferrous oxide", "All of the above"],
            ans: 3, // d
            tag: "HPSSC JE 2018",
            sol: "Fly ash contains Silica, Alumina, Iron oxide, and Calcium oxide. It is a pozzolanic material."
        },
        {
            id: 1088,
            text: "As per IS 8112:2013, the fineness (m2/kg), soundness by Le Chatelier (mm), and initial setting time (min) of 43 grade OPC should be:",
            options: ["225, 10, 30", "225, 0.8, 30", "225, 0.8, 60", "325, 10, 10"],
            ans: 0, // a
            tag: "DSSSB JE 23.10.2019",
            sol: "For OPC 43 (IS 8112):\nFineness: Min 225 m2/kg\nSoundness (Le Chatelier): Max 10 mm\nInitial Setting Time: Min 30 min."
        },
        {
            id: 1089,
            text: "The Bogue compound responsible for the initial setting and generating maximum heat of hydration of the cement is:",
            options: ["C4AF", "C2S", "C3A", "C3S"],
            ans: 2, // c
            tag: "Odisha JE 2015",
            sol: "C3A (Tricalcium Aluminate) reacts fastest with water, responsible for flash set and generates the maximum heat of hydration per unit mass initially."
        },
        {
            id: 1090,
            text: "________ apparatus is used to find the soundness of cement :",
            options: ["Specific gravity bottle", "Le chatelier", "Vicat", "Blaine"],
            ans: 1, // b
            tag: "DSSSB JE 4.11.2019",
            sol: "Soundness due to free lime is measured by Le-Chatelier apparatus. Soundness due to Magnesia and lime is measured by Autoclave."
        },
        {
            id: 1091,
            text: "If p is the standard consistency of cement, the amount of water used to find the initial setting time is:",
            options: ["0.75 P", "0.85 P", "0.78 P", "0.60 P"],
            ans: 1, // b
            tag: "DSSSB JE 4.11.2019",
            sol: "Water requirements:\nInitial/Final Setting Time: 0.85 P\nSoundness: 0.78 P\nCompressive Strength: (P/4 + 3)%"
        },
        {
            id: 1092,
            text: "Excess gypsum content in cement will :",
            options: ["Make the set cement paste more Stable", "Enhance the strength", "Enhance hydration rate", "Leads to an expansion and disruption"],
            ans: 3, // d
            tag: "DSSSB JE 4.11.2019",
            sol: "Excess gypsum causes expansion and consequent disruption of the set cement paste due to formation of excess ettringite after hardening."
        },
        {
            id: 1093,
            text: "Which of the following is correct with respect to Vicat apparatus?",
            options: ["It has 10 mm diameter needle for normal consistency", "It has 10 cm diameter needle", "It has 5 cm diameter needle", "It has 1 cm diameter needle"],
            ans: 0, // a
            tag: "DSSSB JE 20.11.2019",
            sol: "For Standard Consistency test, the Vicat plunger has a diameter of 10 mm and length of 50 mm."
        },
        {
            id: 1094,
            text: "Pick the correct statement among the following sentences regarding adulterated cement:",
            options: ["It does not change colour when heated", "It changes colour when heated", "Physical tests are at 38C", "None"],
            ans: 1, // b
            tag: "DSSSB JE 20.11.2019",
            sol: "Adulterated cement changes its colour after heating it to high temperature."
        },
        {
            id: 1095,
            text: "According to IS code, the time elapsed between moment at which water is added to the cement to the moment at which cement starts to lose its plasticity shall not be less than :",
            options: ["30 minutes", "150 minutes", "90 minutes", "50 minutes"],
            ans: 0, // a
            tag: "DSSSB JE 20.11.2019",
            sol: "This definition describes 'Initial Setting Time'. For OPC, it shall not be less than 30 minutes."
        },
        {
            id: 1096,
            text: "Specific surface (in m¬≤/kg) of ordinary portland cement is NOT less than :",
            options: ["225", "150", "100", "175"],
            ans: 0, // a
            tag: "DSSSB JE 4.11.2019",
            sol: "As per IS codes:\nOPC 33, 43, 53: Min 225 m¬≤/kg\nPPC: Min 300 m¬≤/kg"
        },
        {
            id: 1097,
            text: "The specific gravity of silica fume is :",
            options: ["1.1", "3.56", "2.2", "1.67"],
            ans: 2, // c
            tag: "DSSSB JE 4.11.2019",
            sol: "The specific gravity of silica fume is typically around 2.20 - 2.30."
        },
        {
            id: 1098,
            text: "Which of the following methods is NOT used to test the degree of fineness of cement?",
            options: ["Tensiometer method", "Sieve method", "Wagner Turbidimeter method", "Air permeability method"],
            ans: 0, // a
            tag: "DSSSB JE 4.11.2019",
            sol: "Fineness methods: Sieve (IS 90 micron), Air Permeability (Blaine), Wagner Turbidimeter. Tensiometer is used for soil moisture."
        },
        {
            id: 1099,
            text: "The process of reaction of carbon dioxide in the atmosphere with alkalis in the cement paste is called ________.",
            options: ["decarbonation", "oxygenation", "carbonation", "deoxygenation"],
            ans: 2, // c
            tag: "DSSSB JE 23.10.2019",
            sol: "Carbonation is the reaction of CO2 from air with Ca(OH)2 in cement to form CaCO3, which lowers pH and can lead to corrosion of steel."
        },
        {
            id: 1100,
            text: "If S is strength of concrete and x is gel/space ratio, then according to Power's and Brownyard the relation is:",
            options: ["S = 240/x¬≤", "S = 140/x¬≥", "S = 140 x¬≤", "S = 240 x¬≥"],
            ans: 3, // d
            tag: "DSSSB JE 23.10.2019",
            sol: "Power's experiment showed S = 240 x¬≥, where 240 represents intrinsic strength of gel in MPa."
        },
        {
            id: 1101,
            text: "The chemical reaction that occurs when cement is mixed with water is known as",
            options: ["Hydration", "Segregation", "Bleeding", "Slaking"],
            ans: 0, // a
            tag: "HSSC JE 12.4.2018",
            sol: "The chemical reaction between cement and water is called Hydration. It is an exothermic reaction."
        },
        {
            id: 1102,
            text: "The theoretical water/cement ratio is",
            options: ["0.35", "0.36", "0.37", "0.38"],
            ans: 3, // d
            tag: "HSSC JE 12.4.2018",
            sol: "Approx 23% water by weight is required for chemical reaction (bound water) + 15% for filling gel pores. Total theoretical minimum = 38% (0.38)."
        },
        {
            id: 1103,
            text: "Which one of the following cement is produced or made conforming to IS 12330:1988?",
            options: ["Portland Slag Cement", "Portland Pozzolana Cement", "Ordinary Portland Cement", "Sulphate Resisting Portland Cement"],
            ans: 3, // d
            tag: "DSSSB JE 23.10.2019",
            sol: "IS 12330:1988 corresponds to Sulphate Resisting Portland Cement (SRPC). It has low C3A (<5%)."
        },
        {
            id: 1104,
            text: "The water cement ratio generally lies between:",
            options: ["0.15-0.20", "0.85-1.50", "0.50-0.10", "0.35-0.65"],
            ans: 3, // d
            tag: "DSSSB JE 23.10.2019",
            sol: "Water cement ratio generally varies from 0.35 to 0.65 depending on the mix design and strength requirements."
        },
        {
            id: 1105,
            text: "Which one of the following cement is made by inter-grinding Portland cement clinker and granulated blast furnace slag?",
            options: ["Portland Pozzolana Cement", "Portland Slag Cement", "Rapid Hardening", "Ordinary Portland"],
            ans: 1, // b
            tag: "DSSSB JE 23.10.2019",
            sol: "Portland Slag Cement (PSC) is produced by inter-grinding clinkers, gypsum and Granulated Blast Furnace Slag (25-65%)."
        },
        {
            id: 1106,
            text: "The Specific gravity of Talc is _____.",
            options: ["3.5", "2.7", "2", "1.7"],
            ans: 1, // b
            tag: "DSSSB JE 23.10.2019",
            sol: "Talc specific gravity is approx 2.7. (Quartz: 2.65, Gypsum: 2.3)."
        },
        {
            id: 1107,
            text: "Which water is chemically combined with the products of hydration and it is non-evaporable?",
            options: ["Combined water", "Capillary water", "Adsorbed water", "Gel water"],
            ans: 0, // a
            tag: "DSSSB JE 23.10.2019",
            sol: "Combined water is chemically combined with the products of hydration and is non-evaporable (approx 23% of cement weight)."
        },
        {
            id: 1108,
            text: "The slag constituent in Portland slag cement varies between what percentage?",
            options: ["30-70 percent", "20-60 percent", "25-65 percent", "28-68 percent"],
            ans: 2, // c
            tag: "DSSSB JE 23.10.2019",
            sol: "Slag content in Portland Slag Cement varies between 25 to 65 percent of the total mass of mixture."
        }
    ];

    // --- VARIABLES ---
    let currentQIndex = 0;
    let answers = {}; // { qId: optionIndex }
    let visited = new Set();
    let reviews = new Set();
    let bookmarks = new Set(JSON.parse(localStorage.getItem('ce_bookmarks')) || []);
    let timerInterval;
    let timeRemaining = 7200; // 2 hours in seconds

    // --- DOM ELEMENTS ---
    const quizContent = document.getElementById('quiz-content');
    const timerDisplay = document.getElementById('timer');
    const paletteGrid = document.getElementById('palette-grid');

    // --- INITIALIZATION ---
    window.onload = function() {
        if(localStorage.getItem('last_ce_score')) {
            document.getElementById('last-score').innerText = "Last Score: " + localStorage.getItem('last_ce_score');
        }
    };

    function startTest() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        startTimer();
        loadQuestion(0);
        updatePalette();
    }

    // --- CORE QUIZ LOGIC ---
    function loadQuestion(index) {
        currentQIndex = index;
        const q = questions[index];
        visited.add(q.id);

        let html = `
            <div class="exam-tag">${q.tag}</div>
            <div class="q-text">Q${q.id}. ${q.text}</div>
            <ul class="options-list">
        `;

        const isAnswered = answers.hasOwnProperty(q.id);
        const userAns = answers[q.id];

        q.options.forEach((opt, i) => {
            let cls = 'option-item';
            let icon = String.fromCharCode(65 + i); // A, B, C, D
            
            if(isAnswered) {
                if(i === q.ans) cls += ' correct';
                else if(i === userAns) cls += ' wrong';
                cls += ' disabled';
            }

            html += `
                <li class="${cls}" onclick="checkAnswer(${q.id}, ${i})">
                    <div class="option-circle">${icon}</div>
                    <span>${opt}</span>
                </li>
            `;
        });

        html += `</ul>`;

        // Solution Block (Show immediately if answered)
        if(isAnswered) {
            html += `
                <div class="solution-box" style="display:block">
                    <span class="solution-title">üí° Detailed Solution:</span>
                    <div class="solution-text">${q.sol}</div>
                </div>
            `;
        } else {
             html += `<div id="sol-${q.id}" class="solution-box">
                    <span class="solution-title">üí° Detailed Solution:</span>
                    <div class="solution-text">${q.sol}</div>
                </div>`;
        }

        quizContent.innerHTML = html;
        updateButtons();
        updatePalette();
    }

    function checkAnswer(qId, selectedIndex) {
        if(answers.hasOwnProperty(qId)) return; // Already answered

        answers[qId] = selectedIndex;
        
        // Refresh UI to show colors and solution immediately
        loadQuestion(currentQIndex); 
    }

    function nextQuestion() {
        if(currentQIndex < questions.length - 1) {
            loadQuestion(currentQIndex + 1);
        }
    }

    function prevQuestion() {
        if(currentQIndex > 0) {
            loadQuestion(currentQIndex - 1);
        }
    }

    function markReview() {
        const qId = questions[currentQIndex].id;
        if(reviews.has(qId)) reviews.delete(qId);
        else reviews.add(qId);
        updatePalette();
    }

    function toggleBookmark() {
        const qId = questions[currentQIndex].id;
        if(bookmarks.has(qId)) {
            bookmarks.delete(qId);
            document.getElementById('bookmark-btn').classList.remove('bookmark-active');
        } else {
            bookmarks.add(qId);
            document.getElementById('bookmark-btn').classList.add('bookmark-active');
        }
        localStorage.setItem('ce_bookmarks', JSON.stringify([...bookmarks]));
    }

    function updateButtons() {
        const qId = questions[currentQIndex].id;
        const btn = document.getElementById('bookmark-btn');
        if(bookmarks.has(qId)) btn.classList.add('bookmark-active');
        else btn.classList.remove('bookmark-active');
    }

    // --- PALETTE LOGIC ---
    function togglePalette() {
        const drawer = document.getElementById('palette-drawer');
        const overlay = document.getElementById('palette-overlay');
        if(drawer.style.right === '0px') {
            drawer.style.right = '-80%';
            overlay.style.display = 'none';
        } else {
            drawer.style.right = '0px';
            overlay.style.display = 'block';
            renderPalette();
        }
    }

    function renderPalette() {
        paletteGrid.innerHTML = '';
        questions.forEach((q, i) => {
            const div = document.createElement('div');
            div.className = 'p-item';
            div.innerText = q.id;
            
            if(i === currentQIndex) div.classList.add('current');
            else if(reviews.has(q.id)) div.classList.add('review');
            else if(answers.hasOwnProperty(q.id)) div.classList.add('answered');
            else if(visited.has(q.id)) div.classList.add('visited');

            div.onclick = () => {
                loadQuestion(i);
                togglePalette();
            };
            paletteGrid.appendChild(div);
        });
    }

    function updatePalette() {
        // Just updates class if palette is open
        if(document.getElementById('palette-drawer').style.right === '0px') {
            renderPalette();
        }
    }

    // --- TIMER ---
    function startTimer() {
        timerInterval = setInterval(() => {
            timeRemaining--;
            let h = Math.floor(timeRemaining / 3600);
            let m = Math.floor((timeRemaining % 3600) / 60);
            let s = timeRemaining % 60;
            timerDisplay.innerText = `${h < 10 ? '0'+h : h}:${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            
            if(timeRemaining <= 0) submitTest();
        }, 1000);
    }

    // --- SUBMISSION ---
    function exitTest() {
        if(confirm("Exit test? Progress will be lost (except History).")) {
            submitTest();
        }
    }

    function submitTest() {
        clearInterval(timerInterval);
        let score = 0;
        let correctCount = 0;

        questions.forEach(q => {
            if(answers[q.id] === q.ans) {
                score++;
                correctCount++;
            }
        });

        const accuracy = Object.keys(answers).length > 0 
            ? Math.round((correctCount / Object.keys(answers).length) * 100) 
            : 0;

        // Save History
        localStorage.setItem('last_ce_score', `${score}/${questions.length}`);

        // Show Result
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');
        document.getElementById('res-score').innerText = `${score} / ${questions.length}`;
        document.getElementById('res-accuracy').innerText = `${accuracy}%`;
        
        let msg = "";
        if(accuracy > 80) msg = "Excellent! üéâ";
        else if(accuracy > 50) msg = "Good job! Keep improving. üëç";
        else msg = "Needs more revision. Don't give up! üí™";
        document.getElementById('res-msg').innerText = msg;
    }

    // --- BOOKMARKS VIEW ---
    function showBookmarks() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('bookmark-screen').classList.add('active');
        const list = document.getElementById('bookmark-list');
        list.innerHTML = '';
        
        if(bookmarks.size === 0) {
            list.innerHTML = '<p style="text-align:center; color:#777;">No bookmarks yet.</p>';
            return;
        }

        const bList = [...bookmarks];
        bList.forEach(id => {
            const q = questions.find(x => x.id === id);
            if(q) {
                list.innerHTML += `
                    <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #eee;">
                        <div style="font-weight:bold; margin-bottom:5px;">Q${q.id}</div>
                        <div>${q.text}</div>
                        <div style="margin-top:10px; font-size:13px; color:var(--success); font-weight:bold;">Ans: ${q.options[q.ans]}</div>
                        <div style="font-size:12px; margin-top:5px; color:#555;">${q.sol}</div>
                    </div>
                `;
            }
        });
    }

</script>
</body>
</html>

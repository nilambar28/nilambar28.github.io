<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RCC Civil Engineering Test (Q30-65)</title>
    <style>
        :root {
            --primary: #e91e63;
            --primary-dark: #c2185b;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --correct: #4caf50;
            --wrong: #f44336;
            --review: #9c27b0;
            --blue-current: #2196f3;
            --skipped: #9e9e9e;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg-color); color: var(--text-color); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- SCREENS --- */
        .screen { display: none; height: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* --- HOME SCREEN --- */
        #home-screen { align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .app-logo { font-size: 50px; margin-bottom: 20px; }
        .stats-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 100%; max-width: 350px; margin-bottom: 20px; text-align: left; }
        .stats-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .btn-large { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 18px; font-weight: bold; cursor: pointer; width: 100%; max-width: 300px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); margin-top: 15px; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-large:active { transform: scale(0.98); }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); margin-top: 15px; }

        /* --- HEADER --- */
        header { background: var(--primary); color: white; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; height: 60px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10; flex-shrink: 0; }
        .timer { font-weight: bold; font-size: 18px; font-family: monospace; background: rgba(0,0,0,0.1); padding: 5px 10px; border-radius: 4px; }
        .header-icons { display: flex; gap: 20px; align-items: center; }
        .header-icon { cursor: pointer; font-size: 20px; font-weight: bold; display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; border-radius: 50%; transition: background 0.2s; }
        .header-icon:active { background: rgba(255,255,255,0.2); }
        
        /* --- MAIN TEST AREA --- */
        #quiz-container { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; position: relative; background: #f0f2f5; }
        .question-card { background: var(--card-bg); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .q-meta { display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .q-tag { background: #e3f2fd; color: #1565c0; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .q-text { font-size: 16px; font-weight: 500; margin-bottom: 20px; line-height: 1.5; color: #000; }
        
        .options { list-style: none; padding: 0; }
        .option { padding: 14px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; transition: all 0.2s; background: #fff; }
        .option-circle { height: 22px; width: 22px; border: 2px solid #ccc; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 12px; font-weight: bold; color: white; }
        
        /* Interaction States */
        .option.selected { border-color: var(--blue-current); background: #e3f2fd; }
        .option.correct { border-color: var(--correct); background: #e8f5e9; }
        .option.wrong { border-color: var(--wrong); background: #ffebee; }
        
        .option.correct .option-circle { border-color: var(--correct); background: var(--correct); content: "‚úì"; }
        .option.wrong .option-circle { border-color: var(--wrong); background: var(--wrong); content: "‚úï"; }

        /* --- SOLUTION BOX --- */
        .solution-box { display: none; margin-top: 20px; background: #f8f9fa; padding: 15px; border-left: 4px solid var(--primary); border-radius: 4px; font-size: 14px; color: #444; line-height: 1.5; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .solution-header { font-weight: bold; color: var(--primary); margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }

        /* --- FOOTER --- */
        footer { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; height: 60px; z-index: 10; box-shadow: 0 -2px 5px rgba(0,0,0,0.05); }
        .nav-btn { background: white; border: 1px solid #ccc; padding: 8px 18px; border-radius: 20px; font-weight: bold; color: #555; cursor: pointer; font-size: 14px; }
        .nav-btn.primary { background: var(--primary); color: white; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .center-actions { display: flex; gap: 20px; }
        .icon-btn { font-size: 24px; padding: 0; border: none; background: none; color: #757575; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; }
        .icon-btn:active { background: #eee; }
        .icon-btn.active-review { color: var(--review); }
        .icon-btn.active-bookmark { color: #ff9800; }

        /* --- PALETTE (Sidebar) --- */
        #palette-overlay { position: fixed; top: 0; right: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 20; display: none; justify-content: flex-end; }
        #palette { width: 85%; max-width: 320px; background: white; height: 100%; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; box-shadow: -2px 0 5px rgba(0,0,0,0.1); }
        .palette-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 10px; align-items: center; }
        .palette-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; }
        .p-item { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 14px; font-weight: bold; cursor: pointer; border: 1px solid #ddd; background: #fff; color: #555; transition: transform 0.1s; }
        .p-item:active { transform: scale(0.9); }
        
        /* Palette Colors */
        .p-item.answered { background: var(--correct); color: white; border-color: var(--correct); }
        .p-item.review { background: var(--review); color: white; border-color: var(--review); }
        .p-item.current { border: 2px solid var(--blue-current); transform: scale(1.1); box-shadow: 0 0 5px rgba(33, 150, 243, 0.4); }
        .p-item.skipped { background: var(--skipped); color: white; border-color: var(--skipped); } /* Gray for skipped/visited but no answer */

        /* Legend */
        .legend { margin-top: auto; padding-top: 20px; font-size: 12px; border-top: 1px solid #eee; }
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; color: #555; }
        .dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 10px; }

        /* --- RESULT SCREEN --- */
        #result-screen { padding: 20px; overflow-y: auto; text-align: center; }
        .score-circle { width: 140px; height: 140px; border-radius: 50%; border: 10px solid var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 30px auto; font-size: 36px; font-weight: bold; color: var(--primary); background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Toast Notification */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 16px; position: fixed; z-index: 30; left: 50%; bottom: 80px; transform: translateX(-50%); font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 80px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 80px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <div class="app-logo">üèóÔ∏è</div>
        <h1 style="color: var(--primary); margin-top:0;">RCC Mix Test</h1>
        <p style="color:#666; margin-bottom:20px;">Questions 30 to 65</p>
        
        <div class="stats-card">
            <h3 style="margin-top:0; color: var(--primary);">Your Progress</h3>
            <div class="stats-row"><span>Last Score:</span> <span id="last-score" style="font-weight:bold;">-</span></div>
            <div class="stats-row"><span>Accuracy:</span> <span id="last-accuracy" style="font-weight:bold;">-</span></div>
            <div class="stats-row" style="border:none;"><span>Tests Taken:</span> <span id="test-count">0</span></div>
        </div>

        <button class="btn-large" onclick="initTest('all')">
            <span>‚ñ∂</span> START NEW TEST
        </button>
        <button class="btn-large btn-secondary" onclick="initTest('bookmark')">
            <span>üîñ</span> REVISE BOOKMARKS
        </button>
        <div style="margin-top:30px; font-size:11px; color:#999;">Ver 3.0 (Q30-65 Included)</div>
    </div>

    <div id="quiz-screen" class="screen">
        <header>
            <div id="timer" class="timer">02:00:00</div>
            <div class="header-icons">
                <div class="header-icon" onclick="submitTest()" title="Submit Test">‚úì</div>
                <div class="header-icon" onclick="exitTest()" title="Exit Test">‚úï</div>
            </div>
        </header>

        <div id="quiz-container">
            </div>

        <footer>
            <button class="nav-btn" onclick="navStep(-1)">Prev</button>
            <div class="center-actions">
                <button class="icon-btn" id="btn-bookmark" onclick="toggleBookmark()">üîñ</button>
                <button class="icon-btn" id="btn-review" onclick="toggleReview()">üü£</button>
                <button class="icon-btn" onclick="togglePalette()">‚ñ¶</button>
            </div>
            <button class="nav-btn primary" onclick="navStep(1)">Next</button>
        </footer>

        <div id="palette-overlay" onclick="togglePalette()">
            <div id="palette" onclick="event.stopPropagation()">
                <div class="palette-header">
                    <span>Question Grid</span>
                    <span onclick="togglePalette()" style="cursor:pointer; font-size:24px;">&times;</span>
                </div>
                <div class="palette-grid" id="palette-grid"></div>
                <div class="legend">
                    <div class="legend-item"><div class="dot" style="background:var(--correct)"></div> Answered</div>
                    <div class="legend-item"><div class="dot" style="background:var(--review)"></div> Marked for Review</div>
                    <div class="legend-item"><div class="dot" style="background:var(--skipped)"></div> Skipped</div>
                    <div class="legend-item"><div class="dot" style="border:2px solid var(--blue-current); background:transparent"></div> Current</div>
                </div>
            </div>
        </div>
    </div>

    <div id="result-screen" class="screen">
        <h2>Test Result</h2>
        <div class="score-circle">
            <span id="score-text">0</span>
            <span style="font-size:14px; color:#666; font-weight:normal; margin-top:5px;">Score</span>
        </div>
        <div class="stats-card" style="margin: 0 auto 20px;">
            <div class="stats-row"><span>Total Questions:</span> <span id="res-total">0</span></div>
            <div class="stats-row"><span>Attempted:</span> <span id="res-attempted">0</span></div>
            <div class="stats-row"><span>Correct:</span> <span id="res-correct" style="color:var(--correct); font-weight:bold;">0</span></div>
            <div class="stats-row"><span>Wrong:</span> <span id="res-wrong" style="color:var(--wrong); font-weight:bold;">0</span></div>
            <div class="stats-row" style="border:none;"><span>Accuracy:</span> <span id="res-accuracy" style="font-weight:bold;">0%</span></div>
        </div>
        <button class="btn-large" onclick="goHome()">Back to Home</button>
    </div>

    <div id="toast">Message</div>

<script>
/* --- DATA DATABASE (Questions 30-65) --- */
const allQuestionsDB = [
    { id: 30, text: "For structures to be permanently immersed in water, minimum grade of concrete should be:", options: ["M 30", "M 25", "M 35", "M 20"], ans: 1, tag: "HPSSC JE 18.04.2021", explanation: "As per IS 456, for severe exposure (permanently immersed in water), min grade for RCC is M30. However, question answers (b) M25. This might be referring to older code or plain concrete. Given answer is M25." },
    { id: 31, text: "Which of the following strain limit is correct for the highly compressed edge in case of an uniaxial eccentric compression?", options: ["0.001", "0.002", "Below 0.002 but greater than 0.001", "A value between 0.002 an 0.0035"], ans: 3, tag: "RPSC Lect. 2021", explanation: "Strain limit is correct for the highly compressed edge in case of an uniaxial eccentric compression value between 0.002 an 0.0035. Uniaxial eccentric load will cause additional BM due to eccentricity." },
    { id: 32, text: "A concrete of 1 : 1 ¬Ω : 3 mix is to be prepared by volumetric batching. Which of the following shall not be measured by volume?", options: ["Sand", "Coarse aggregate", "Cement", "None of these"], ans: 2, tag: "RPSC Lect. 2021", explanation: "In volume batching all the ingredients of concrete are measured by volume only where as in weight batching all ingredients are measured by weight. However, cement is always measured by weight." },
    { id: 33, text: "The minimum stripping time of soffit formwork to beams (props to be refixed immediately after removal of formwork) is:", options: ["3 days", "7 days", "14 days", "21 days"], ans: 1, tag: "SSC JE 23.03.2021", explanation: "Beam soffits with props left in position: 7 days. Walls/columns: 16-24 hr. Slabs with props: 3 days." },
    { id: 34, text: "Which of the following Indian Standard Codes provides conservatively imposed loads for buildings and structures?", options: ["IS 875 (part 4)-1987", "IS 875 (part 1)-1987", "IS 875 (part 3)-1987", "IS 875 (part 2)-1987"], ans: 3, tag: "SSC JE 23.03.2021", explanation: "For imposed loads given in IS 875 (Part 2). Dead loads: Part 1. Wind loads: Part 3. Snow loads: Part 4. Seismic: IS 1893." },
    { id: 35, text: "The tolerances on placing of reinforcement for RCC members exceeding the effective depth of 200 mm is:", options: ["¬±20 mm", "¬±15 mm", "¬±10 mm", "None of the above"], ans: 2, tag: "Assam PSC AE 2021", explanation: "Tolerance on placing of reinforcement: For effective depth 200 mm or less: ¬± 10 mm. For effective depth more than 200 mm: ¬± 15 mm. Wait, text says 'Ans (b)'. Option b is ¬±15mm. Wait, table says >200mm is ¬±10mm? No, table says <=200 is ¬±10, >200 is ¬±15. So Ans is (b) ¬±15 mm." },
    { id: 36, text: "The property of concrete that performs satisfactorily under anticipated working conditions during its service life span, is:", options: ["Durability", "Workability", "Characteristic strength", "Quality"], ans: 0, tag: "DGVCL 5.1.2021", explanation: "The property of concrete that performs satisfactorily under anticipated working conditions during its service life span, is durability." },
    { id: 37, text: "As per IS456:2000, the specified characteristic compressive cube strength of M70 concrete, is", options: ["80 N/mm¬≤", "77 N/mm¬≤", "70 N/mm¬≤", "60 N/mm¬≤"], ans: 2, tag: "DGVCL 06.01.2021", explanation: "As per IS 456 : 2000, the specified characteristic compressive cube strength of M 70 concrete is 70 N/mm¬≤ after curing of 28 days." },
    { id: 38, text: "As per IS : 10262 : 2009, standard deviation for M25 concrete is", options: ["4.0", "3.5", "5.0", "4.5"], ans: 0, tag: "SSC JE 23.03.2021", explanation: "Standard deviation for M20, M25 is 4.0 N/mm¬≤. For M30-M50 it is 5.0." },
    { id: 39, text: "What is the target mean strength for the M35 grade concrete, if the standard deviation is 5.0?", options: ["40", "36.65", "35", "43.25"], ans: 3, tag: "PGCIL DET 17.11.2018", explanation: "fm = fck + 1.65œÉ = 35 + 1.65(5) = 35 + 8.25 = 43.25 N/mm¬≤." },
    { id: 40, text: "The density of reinforced cement concrete with 2 percent steel reinforcement is:", options: ["1800 Kg/Cum", "2800 Kg/Cum", "2400 Kg/Cum", "3100 Kg/Cum"], ans: 2, tag: "DSSSB JE 19.03.2021", explanation: "Ans (c): The density of reinforced cement concrete with 2 percent steel reinforcement is 2400 kg/cum. (Note: Standard values are PCC 2400, RCC 2500, but text specifically marks 2400)." },
    { id: 41, text: "As per IS 456:2000 code, the maximum permissible free water cement ratio for Reinforced concrete work in moderate environmental exposure condition with 20 mm nominal maximum size aggregate, is-", options: ["0.50", "0.55", "0.40", "0.60"], ans: 0, tag: "DSSSB JE 20.03.2021", explanation: "For Moderate exposure: Max w/c ratio is 0.50 (RCC)." },
    { id: 42, text: "The loads which shall comprise of the weight of all walls, partitions, floors and shall include the weights of all other permanent construction in the building are known as", options: ["Live loads", "Distributed loads", "Dead loads", "Wind loads"], ans: 2, tag: "DSSSB JE 20.03.2021", explanation: "The loads which shall comprise of the weight of all walls, partitions, floors... are known as dead loads." },
    { id: 43, text: "A movement joint with complete discontinuity in both reinforcement and concrete, and intended to accommodate either expansion or contraction of structure is known as", options: ["Simple contraction joint", "Expansion joint in R.C.C.", "Sliding joint in R.C.C.", "Complete contraction joint"], ans: 2, tag: "DSSSB JE 20.03.2021", explanation: "A movement joint with complete discontinuity... is known as sliding joint in R.C.C. constructions." },
    { id: 44, text: "IS code used for design of earthquake resistant design of R.C. building is", options: ["IS 875 : 2016 Part I", "IS 1893 : 2016 Part I", "IS 1893 : 2016 Part III", "IS 13290 : 2016"], ans: 1, tag: "HPSSSC JE 11.04.2021", explanation: "IS code used for design of earthquake resistant design of RC building is IS 1893 : 2016 Part (I)." },
    { id: 45, text: "As per 13920 : 2016, minimum grade of structural concrete shall be M20 but M25 for building", options: ["More than 15 m in height in all zones.", "More than 15 m in height in III, IV & V zones.", "More than 15 m in height in II zone only.", "None of these"], ans: 1, tag: "HPSSSC JE 11.04.2021", explanation: "Minimum grade of structural concrete shall be M 20, but M 25 for buildings more than 15 m in height in seismic zones III, IV, V." },
    { id: 46, text: "When HYSD bars are used in place of mild steel bars in a beam, the bond strength", options: ["does not change", "increases", "decreases", "becomes zero"], ans: 1, tag: "JPSC AE 10.04.2021", explanation: "As per clause 26.2.1, when HYSD bars are used in place of mild steel bars in a beam, the bond strength increases by 60%." },
    { id: 47, text: "The minimum 0.2% proof stress (N/sq.mm) of Fe 500 steel will be:", options: ["450", "500", "475", "510"], ans: 1, tag: "DDA JE 24.04.2018", explanation: "As per IS 1786... minimum 0.2% proof stress... of Fe 500 is 500." },
    { id: 48, text: "The minimum ultimate tensile strength of cold-twisted bar is:", options: ["425 N/mm¬≤", "495 N/mm¬≤", "565 N/mm¬≤", "595 N/mm¬≤"], ans: 2, tag: "KERALA PSC Code 196/2015", explanation: "The minimum ultimate tensile strength of cold-twisted bar is 565 N/mm¬≤ (Fe 500 D)." },
    { id: 49, text: "Zone factor for severe seismic intensity as per IS 1893 (part 1) : 2002 is :", options: ["0.16", "0.24", "0.1", "0.36"], ans: 1, tag: "UPPCL JE 25.02.2020", explanation: "Severe seismic intensity corresponds to Zone IV. Z = 0.24." },
    { id: 50, text: "Fe415 in RCC construction implies", options: ["Iron of grade 415", "High Yield Strength Deformed steels bars used in RCC", "Mild structural steel", "None of the above"], ans: 1, tag: "ISRO TA 2016", explanation: "Fe415 implies High Yield Strength Deformed (HYSD) steel bars." },
    { id: 51, text: "What is the thickness of plastic concrete on which rubbles are placed during vibration?", options: ["65 cm", "50 cm", "60 cm", "55 cm"], ans: 2, tag: "DSSSB JE 23.10.2019", explanation: "The thickness of plastic concrete on which rubbers are placed during vibration is 60 cm." },
    { id: 52, text: "The strength of concrete is maximum in", options: ["compression", "shear", "twisting", "fatigue"], ans: 0, tag: "BPSC AE 2019", explanation: "Concrete is strong in compression and weak in tension." },
    { id: 53, text: "If value of characteristics stress is 250 N/mm¬≤ and permissible is 150 N/mm¬≤, what shall be the Factor of Safety?", options: ["1.67", "2.67", "0.67", "1"], ans: 0, tag: "MH PWD 2019", explanation: "FOS = Ultimate / Permissible = 250 / 150 = 1.67." },
    { id: 54, text: "Poisson's ratio for concrete", options: ["remains constant", "increases with richer mixes", "decreases with richer mixes", "none of the above"], ans: 1, tag: "GPSC AM 2020", explanation: "Poisson ratio for concrete increase with richer mixture. ¬µ = 0.1 for high strength, 0.15 for standard, 0.20 for low strength." },
    { id: 55, text: "The standard gauge length over which the extension is to be measured to determine percentage elongation (Ao = initial cross section) is :", options: ["‚àö6.56 Ao", "6.56‚àöAo", "5.65‚àöAo", "6.65‚àöAo"], ans: 2, tag: "Rajasthan JE 2020", explanation: "Standard gauge length = 5.65 ‚àöAo." },
    { id: 56, text: "For normal RCC works, i.e., slabs, columns, beams, walls etc, the grade of concrete mix used is generally :", options: ["1 : 3 : 8", "1 : 2 : 4", "1 : 1.5 : 3", "1 : 4 : 8"], ans: 2, tag: "Odisha JE 2014", explanation: "M20 (1 : 1.5 : 3) is generally used for RCC structure (slab, beams, columns, etc)." },
    { id: 57, text: "For an RCC structure, 100 cum concreting is done continuously. The minimum number of samples to be prepared for testing as per IS 456:2000 will be", options: ["4", "5", "6", "7"], ans: 1, tag: "HPSSC JE 2018", explanation: "For 51m3 and above: 4 + 1 for each additional 50m3. For 100m3 = 50(4) + 50(1) = 5 samples." },
    { id: 58, text: "What is the permissible width of crack in concrete structures as per the IS: 456-2000 for moderate environmental conditions?", options: ["0.2 mm", "0.4 mm", "0.6 mm", "0.8 mm"], ans: 0, tag: "JKSSB JE 2013", explanation: "Limits on crack width: Mild 0.3mm, Moderate 0.2mm, Severe 0.1mm." },
    { id: 59, text: "As per IS: 456-2000, the acceptable limits of crack-width for concrete structures exposed to mild and moderate exposure categories or conditions are", options: ["0.3 mm and 0.2 mm respectively", "0.2 mm and 0.3 mm respectively", "0.3 mm and 0.2 mm respectively", "0.15 mm and 0.5 mm respectively"], ans: 0, tag: "BSPHCL 2019", explanation: "Mild: 0.3 mm. Moderate: 0.2 mm." },
    { id: 60, text: "As per IS: 456-2000, the value of creep coefficient at 7 days shall be", options: ["2.6", "1.1", "2.2", "1.6"], ans: 2, tag: "BSPHCL 2019", explanation: "Creep coefficient: 7 days = 2.2; 28 days = 1.6; 1 year = 1.1." },
    { id: 61, text: "Un-factored maximum bending moment... 50, 80, 120 and 180 kNm under dead, live, wind and earthquake loads respectively. The design moment is:", options: ["195", "250", "345", "372"], ans: 3, tag: "HSSC JE 2015", explanation: "Design bending moment = Max of [1.5(D+L)=195, 1.5(D+W)=255, 1.5(D+E)=345, 1.2(D+L+E)=372]. Max is 372 kNm." },
    { id: 62, text: "Lap splices shall not be used for bar larger than", options: ["20 mm", "25 mm", "36 mm", "32 mm"], ans: 2, tag: "Mizoram PSC 2018", explanation: "As per amendment number 3 of IS : 456. Lap splices shall not be used for bar larger than 32 mm diameter. (Note: Option C is 36mm, which is > 32mm)." },
    { id: 63, text: "The form work the slabs excluding prop, can be removed only after.", options: ["One Day", "Four Day", "Seven Day", "Fourteen Day"], ans: 1, tag: "HPSSC JE Code 343/2018", explanation: "Ans (b): The form work from the slabs excluding prop, can be removed only after 4 days. (Standard IS code for soffits is 3 days, but question text specifies 4)." },
    { id: 64, text: "Generally acceptable nominal size of aggregates for reinforced concrete, is", options: ["20 mm", "10mm", "15mm", "40mm"], ans: 0, tag: "HPSSC JE 2018", explanation: "Generally acceptable nominal size of aggregate for reinforced concrete is 20 mm." },
    { id: 65, text: "The minimum number of sample of concrete with designed concrete mix of a particular grade quantity above 15 m3 and 30 m3 shall be :", options: ["5", "3", "7", "None"], ans: 1, tag: "Assam PSC AE 2020", explanation: "For 16-30 m3: Number of samples is 3. (For 6-15 m3: 2 samples)." }
];

/* --- STATE VARIABLES --- */
let activeQuestions = [];
let currentIndex = 0;
let userAnswers = {}; // { qId: optionIndex }
let reviewList = new Set();
let timerInterval;
let timeLeft;
let bookmarks = JSON.parse(localStorage.getItem('civilAppBookmarks_v2')) || [];
let history = JSON.parse(localStorage.getItem('civilAppHistory_v2')) || {score:0, total:0, accuracy:0, count:0};

/* --- INITIALIZATION --- */
window.onload = function() {
    updateHomeStats();
};

function updateHomeStats() {
    if(history.count > 0) {
        document.getElementById('last-score').innerText = `${history.score}/${history.total}`;
        document.getElementById('last-accuracy').innerText = `${history.accuracy}%`;
        document.getElementById('test-count').innerText = history.count;
    }
}

function showToast(msg) {
    const x = document.getElementById("toast");
    x.innerText = msg;
    x.className = "show";
    setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
}

/* --- CORE TEST FUNCTIONS --- */
function initTest(mode) {
    // 1. Determine Questions based on Mode
    if(mode === 'bookmark') {
        if(bookmarks.length === 0) {
            alert("No bookmarks saved yet! Go to Full Test and bookmark some questions.");
            return;
        }
        activeQuestions = allQuestionsDB.filter(q => bookmarks.includes(q.id));
    } else {
        activeQuestions = [...allQuestionsDB]; // Copy all
    }

    // 2. Reset State
    currentIndex = 0;
    userAnswers = {};
    reviewList.clear();
    timeLeft = (mode === 'bookmark') ? (activeQuestions.length * 90) : 7200; // 2 min per q for bookmarks, 2h for full

    // 3. Switch Screens
    document.querySelector('.active').classList.remove('active');
    document.getElementById('quiz-screen').classList.add('active');

    // 4. GENERATE PALETTE FIRST (Fixes the crash)
    generatePalette();

    // 5. Render First Question & Start Timer
    renderQuestion();
    startTimer();
}

function generatePalette() {
    const grid = document.getElementById('palette-grid');
    grid.innerHTML = "";
    activeQuestions.forEach((q, idx) => {
        const item = document.createElement('div');
        item.className = 'p-item';
        item.innerText = idx + 1;
        item.id = `p-idx-${idx}`;
        item.onclick = () => {
            currentIndex = idx;
            renderQuestion();
            togglePalette();
        };
        grid.appendChild(item);
    });
}

function renderQuestion() {
    const q = activeQuestions[currentIndex];
    const container = document.getElementById('quiz-container');
    const isAnswered = userAnswers.hasOwnProperty(q.id);
    const selectedOpt = userAnswers[q.id];

    // Update Header Icons
    const isBookmarked = bookmarks.includes(q.id);
    const btnBook = document.getElementById('btn-bookmark');
    btnBook.innerText = isBookmarked ? "üè∑Ô∏è" : "üîñ";
    btnBook.classList.toggle('active-bookmark', isBookmarked);
    
    const isReview = reviewList.has(q.id);
    document.getElementById('btn-review').classList.toggle('active-review', isReview);

    let html = `
        <div class="question-card">
            <div class="q-meta">
                <span class="q-tag">${q.tag}</span>
                <span>Q.${currentIndex + 1} / ${activeQuestions.length}</span>
            </div>
            <div class="q-text">${q.text}</div>
            <ul class="options">
    `;

    q.options.forEach((opt, idx) => {
        let className = "option";
        
        if (isAnswered) {
            if (idx === q.ans) { className += " correct"; }
            else if (idx === selectedOpt) { className += " wrong"; }
            
            html += `<li class="${className}">
                <div class="option-circle">${idx===q.ans ? "‚úì" : (idx===selectedOpt ? "‚úï" : "")}</div>
                ${opt}
            </li>`;
        } else {
            html += `<li class="${className}" onclick="handleAnswer(${idx})">
                <div class="option-circle"></div>
                ${opt}
            </li>`;
        }
    });

    html += `</ul>`;

    if (isAnswered) {
        html += `
            <div class="solution-box" style="display:block">
                <div class="solution-header">üìã Solution Report</div>
                ${q.explanation}
            </div>
        `;
    }

    html += `</div>`;
    container.innerHTML = html;
    
    updatePaletteUI();
}

function updatePaletteUI() {
    activeQuestions.forEach((q, idx) => {
        const el = document.getElementById(`p-idx-${idx}`);
        if(!el) return;

        el.className = 'p-item'; // Reset
        if (currentIndex === idx) el.classList.add('current');
        
        if (userAnswers.hasOwnProperty(q.id)) {
            el.classList.add('answered');
        } else if (reviewList.has(q.id)) {
            el.classList.add('review');
        } else if (idx < currentIndex && !userAnswers.hasOwnProperty(q.id)) {
             // Optional: Mark visited but skipped as Gray if you strictly want "Red" for skipped in final result, 
             // but usually palette shows skipped as standard or a specific color.
             // For now, let's keep visited items standard unless explicitly "skipped" logic is tracked.
             el.classList.add('skipped');
        }
    });
}

function handleAnswer(optIdx) {
    const q = activeQuestions[currentIndex];
    userAnswers[q.id] = optIdx;
    renderQuestion(); // Re-render to show solution immediately
}

function navStep(step) {
    const newIndex = currentIndex + step;
    if (newIndex >= 0 && newIndex < activeQuestions.length) {
        currentIndex = newIndex;
        renderQuestion();
    }
}

/* --- FEATURES --- */
function toggleBookmark() {
    const qId = activeQuestions[currentIndex].id;
    if(bookmarks.includes(qId)) {
        bookmarks = bookmarks.filter(id => id !== qId);
        showToast("Removed from Bookmarks");
    } else {
        bookmarks.push(qId);
        showToast("Added to Bookmarks");
    }
    localStorage.setItem('civilAppBookmarks_v2', JSON.stringify(bookmarks));
    renderQuestion();
}

function toggleReview() {
    const qId = activeQuestions[currentIndex].id;
    if (reviewList.has(qId)) {
        reviewList.delete(qId);
        showToast("Unmarked from Review");
    } else {
        reviewList.add(qId);
        showToast("Marked for Review");
    }
    renderQuestion();
    updatePaletteUI();
}

function togglePalette() {
    const overlay = document.getElementById('palette-overlay');
    const isVisible = overlay.style.display === 'flex';
    overlay.style.display = isVisible ? 'none' : 'flex';
}

function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        const hours = Math.floor(timeLeft / 3600).toString().padStart(2, '0');
        const mins = Math.floor((timeLeft % 3600) / 60).toString().padStart(2, '0');
        const secs = (timeLeft % 60).toString().padStart(2, '0');
        document.getElementById('timer').innerText = `${hours}:${mins}:${secs}`;
        if (timeLeft <= 0) submitTest();
    }, 1000);
}

function exitTest() {
    if(confirm("Exit Test? Progress will be lost.")) {
        goHome();
    }
}

function goHome() {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('home-screen').classList.add('active');
    clearInterval(timerInterval);
    updateHomeStats();
}

function submitTest() {
    if(!confirm("Are you sure you want to submit?")) return;
    
    clearInterval(timerInterval);
    document.querySelector('.active').classList.remove('active');
    document.getElementById('result-screen').classList.add('active');

    let correct = 0;
    let wrong = 0;
    
    // Calculate Score based on User Answers vs Active Questions
    activeQuestions.forEach(q => {
        if(userAnswers.hasOwnProperty(q.id)) {
            if(userAnswers[q.id] === q.ans) correct++;
            else wrong++;
        }
    });

    const attempted = Object.keys(userAnswers).length;
    const accuracy = attempted > 0 ? Math.round((correct / attempted) * 100) : 0;
    const total = activeQuestions.length;

    document.getElementById('score-text').innerText = correct;
    document.getElementById('res-total').innerText = total;
    document.getElementById('res-attempted').innerText = attempted;
    document.getElementById('res-correct').innerText = correct;
    document.getElementById('res-wrong').innerText = wrong;
    document.getElementById('res-accuracy').innerText = accuracy + "%";

    // Update Global History (only if it's a significant attempt)
    history = { 
        score: correct, 
        total: total, 
        accuracy: accuracy, 
        count: (history.count || 0) + 1 
    };
    localStorage.setItem('civilAppHistory_v2', JSON.stringify(history));
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Irrigation Engg Mock (Q310-361)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        
        :root {
            --primary: #127cc0; /* Testbook Blue */
            --green: #2dbd5c;   /* Answered */
            --red: #e74c3c;     /* Skipped */
            --purple: #8e44ad;  /* Review */
            --gray: #ecf0f1;    /* Not Visited */
            --text: #333;
            --light-bg: #f5f7f9;
        }

        * { box-sizing: border-box; font-family: 'Roboto', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--light-bg); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- SCREENS --- */
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: none; overflow-y: auto; }
        .screen.active { display: flex; flex-direction: column; }

        /* 1. START SCREEN */
        #start-screen { align-items: center; justify-content: center; padding: 20px; text-align: center; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .start-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 400px; width: 100%; }
        .start-btn { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 20px; box-shadow: 0 4px 10px rgba(18, 124, 192, 0.3); transition: transform 0.2s; }
        .start-btn:active { transform: scale(0.95); }

        /* 2. QUIZ SCREEN */
        /* Header */
        header { background: #fff; padding: 0 15px; height: 60px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 10; flex-shrink: 0; }
        .timer { font-weight: 700; color: #333; font-size: 1.1rem; background: #eef2f5; padding: 5px 12px; border-radius: 4px; border: 1px solid #ddd; }
        .submit-header-btn { background: var(--red); color: white; border: none; padding: 8px 16px; border-radius: 4px; font-weight: bold; font-size: 0.9rem; cursor: pointer; }

        /* Layout */
        .container { display: flex; flex: 1; overflow: hidden; position: relative; }
        .main-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        
        /* Sidebar */
        .sidebar { width: 300px; background: #fff; border-left: 1px solid #ddd; display: flex; flex-direction: column; position: absolute; right: 0; top: 0; bottom: 0; transform: translateX(100%); transition: 0.3s; z-index: 100; box-shadow: -5px 0 15px rgba(0,0,0,0.1); }
        .sidebar.open { transform: translateX(0); }
        
        /* Question Card */
        .q-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .meta { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .tag { background: #e1f0fa; color: var(--primary); padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.75rem; }
        .q-text { font-size: 1.1rem; line-height: 1.6; color: #2c3e50; font-weight: 500; margin-bottom: 25px; }

        /* Options */
        .opt { display: flex; align-items: flex-start; padding: 14px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; background: #fff; }
        .opt:hover { background: #f8fbff; border-color: #b3d7ff; }
        .opt.selected { border-color: var(--primary); background: #f0f7fc; box-shadow: 0 0 0 1px var(--primary) inset; }
        .circle { width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 50%; margin-right: 15px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; color: #777; }
        .opt.selected .circle { border-color: var(--primary); background: var(--primary); color: white; }

        /* Footer */
        footer { position: fixed; bottom: 0; width: 100%; height: 60px; background: #fff; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; padding: 0 15px; z-index: 50; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .btn { padding: 10px 18px; border-radius: 6px; border: 1px solid #ddd; background: #fff; font-weight: 600; cursor: pointer; font-size: 0.9rem; transition: background 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-main { background: var(--green); color: white; border: none; }
        .btn-rev { color: var(--purple); border-color: var(--purple); }
        .btn-rev:hover { background: #fbf5ff; }

        /* Palette Grid */
        .p-header { padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .grid { padding: 10px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; overflow-y: auto; flex: 1; align-content: start; }
        .p-item { height: 40px; width: 40px; display: flex; justify-content: center; align-items: center; border-radius: 6px; font-size: 0.9rem; font-weight: bold; cursor: pointer; border: 1px solid #e0e0e0; background: #fff; color: #555; }
        .p-item.current { border: 2px solid var(--primary); }
        .p-item.ans { background: var(--green); color: white; border: none; clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%, 0 20%); border-radius: 4px; }
        .p-item.rev { background: var(--purple); color: white; border: none; border-radius: 50%; }
        .p-item.skip { background: var(--red); color: white; border: none; border-radius: 50%; }
        
        /* 3. RESULT SCREEN */
        #result-screen { padding: 20px; background: #f0f2f5; }
        .score-card { background: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .big-score { font-size: 3rem; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .sol-container { max-width: 800px; margin: 0 auto; }
        .sol-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 15px; border: 1px solid #e1e4e8; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; display: inline-block; }
        .b-correct { background: #e6fffa; color: #00bfa5; }
        .b-wrong { background: #fff5f5; color: #e53e3e; }
        .b-skip { background: #edf2f7; color: #718096; }
        .expl { background: #f7fafc; padding: 15px; margin-top: 15px; border-radius: 6px; border-left: 4px solid var(--primary); font-size: 0.95rem; color: #4a5568; }

    </style>
</head>
<body>

    <div id="start-screen" class="screen active">
        <div class="start-card">
            <h1 style="color:var(--primary); margin-bottom:10px;">Irrigation Engineering</h1>
            <h3 style="color:#555; margin-bottom:20px;">Mock Test (Q310 - Q361)</h3>
            <div style="text-align:left; margin-bottom:20px; color:#666; font-size:0.95rem;">
                <p>‚úÖ <b>Total Questions:</b> 52</p>
                <p>‚è± <b>Time:</b> 120 Minutes</p>
                <p>üéØ <b>Correct:</b> +1.0 | <b>Wrong:</b> -0.25</p>
            </div>
            <button class="start-btn" onclick="startTest()">Start Test Now</button>
            <br><br>
            <button onclick="showHistory()" style="background:none; border:none; color:#666; text-decoration:underline; cursor:pointer;">View History</button>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <header>
            <div style="font-weight:bold; font-size:1.1rem; color:#333;">Irrigation Test</div>
            <div class="timer" id="timer">02:00:00</div>
            <button class="submit-header-btn" onclick="submitTest()">Submit Test</button>
        </header>

        <div class="container">
            <div class="main-content" id="q-area">
                </div>

            <div class="sidebar" id="sidebar">
                <div class="p-header">
                    <span>Question Palette</span>
                    <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.2rem;">&times;</span>
                </div>
                <div style="padding:10px; font-size:0.8rem; background:#fff; border-bottom:1px solid #eee;">
                    <span style="color:var(--green)">‚óè Ans</span> &nbsp;
                    <span style="color:var(--red)">‚óè Skip</span> &nbsp;
                    <span style="color:var(--purple)">‚óè Rev</span> &nbsp;
                    <span style="color:#999">‚óè Not Vis</span>
                </div>
                <div class="grid" id="grid">
                    </div>
                <div style="padding:15px; border-top:1px solid #ddd; text-align:center;">
                    <button class="submit-header-btn" style="width:100%; background:var(--primary);" onclick="submitTest()">Submit Test</button>
                </div>
            </div>
        </div>

        <footer>
            <button class="btn" onclick="prevQ()">Previous</button>
            <button class="btn btn-rev" onclick="markReview()">Mark Review</button>
            <button class="btn" onclick="toggleSidebar()">Palette</button>
            <button class="btn btn-main" onclick="nextQ()">Save & Next</button>
        </footer>
    </div>

    <div id="result-screen" class="screen">
        <div class="score-card">
            <h2>Test Submitted Successfully!</h2>
            <div class="big-score" id="score-txt">0/52</div>
            <p style="color:#666;">Accuracy: <span id="acc-txt">0%</span></p>
            <div style="margin-top:20px;">
                <button class="btn" onclick="location.reload()">Back to Home</button>
            </div>
        </div>
        <h3 style="text-align:center; color:#444;">Detailed Solutions</h3>
        <div class="sol-container" id="sol-container"></div>
    </div>

<script>
    // --- FULL DATA (Q310-Q361) ---
    const db = [
{i:310,t:"DMRC 26.02.2020",q:"What is the depth of water to be applied for a particular stage of the growth of a crop when the amount of water available in the soil is 35%, if 0% of the maximum depth of available water in the root zone which is 80 mm and assuming irrigation efficiency is 60%?",o:["84 mm","90 mm","87 mm","81 mm"],a:2,s:"Water req = (Max Depth * (1-0.35)) / Eff = (80 * 0.65) / 0.60 = 86.66 ‚âà 87mm."},
{i:311,t:"WBPSC JE 2009",q:"The duty of a crop is 432 hectares/cumec, when the base period of the crop is 100 days. Delta for the crop will be:",o:["132","200","464","846"],a:1,s:"Delta = 8.64B/D = 8.64*100/432 = 200cm."},
{i:312,t:"MP VYAPAM 2017",q:"What is the classification of irrigation water having the following characteristics: concentration of Na, Ca and Mg are 24, 5 and 3 milli-equivalents per liter, respectively?",o:["Low sodium water","Very high sodium water","High sodium water","Medium sodium water"],a:3,s:"SAR = 24 / sqrt((5+3)/2) = 12. SAR 10-18 is Medium (S2)."},
{i:313,t:"SSC JE 2017",q:"The field irrigation requirement is computed as",o:["Consumptive use + field application losses","Net irrigation requirement + field application losses","Net irrigation requirement + conveyance losses","Consumptive use + conveyance losses"],a:1,s:"FIR = NIR + Field Application Losses."},
{i:314,t:"MH PWD 2018",q:"The average delta of rice crop is nearly :",o:["60 cm","30 cm","175 cm","120 cm"],a:3,s:"Rice Delta ‚âà 120cm."},
{i:315,t:"MP VYAPAM 2015",q:"Which of the following crops has maximum Duty?",o:["Sugar cane","Rice","Bajra","Wheat"],a:2,s:"Bajra needs least water => Max Duty."},
{i:316,t:"UPPCL JE 2020",q:"Which of the following is NOT a Kharif crop?",o:["Jowar","Wheat","Rice","Bajra"],a:1,s:"Wheat is Rabi."},
{i:317,t:"MP VYAPAM 2016",q:"The culturable commanded area for a distributary is 2 √ó 10^8 m¬≤. The intensity of irrigation of a crops is 40% if kor water depth and kor period for the crop are 14 cm and 4 week. respectively, the peak demand discharge is:",o:["2.63 m¬≥/s","4.63 m¬≥/s","8.58 m¬≥/s","11.58 m¬≥/s"],a:1,s:"Area=8000ha. D=8.64*28/0.14=1728. Q=8000/1728=4.63."},
{i:318,t:"MP VYAPAM 2018",q:"The delta for a crop having a base period of 150 days when its duty is 432 hectares/cumec on the field will be",o:["1.5 m","1.5 cm","3.0 m","3.0 cm"],a:2,s:"Delta = 8.64*150/432 = 3.0m."},
{i:319,t:"DMRC JE 2018",q:"The method of growing crops in rotation, one after the other, in the same field, is known as:",o:["Crop development","Crop rotation","Mixed farming","Crop optimization"],a:1,s:"It is Crop Rotation."},
{i:320,t:"Nagaland PSC 2016",q:"Mixed crop of the following is",o:["Rice","Wheat","Sugarcane","Wheat and gram"],a:3,s:"Wheat and Gram is a common mixed crop."},
{i:321,t:"Nagaland PSC 2016",q:"C.C.A means",o:["Gross commanded area","Culturable commanded area","Irrigated area","Uncultivated area"],a:1,s:"Culturable Commanded Area."},
{i:322,t:"APPSC AE 2016",q:"If average rate of infiltration is 5 cm/h, what will be the maximum area that can be irrigated by a stream with a discharge of 0.05 m¬≥/s?",o:["0.36 hectares","36 hectares","0.864 hectares","0.25 hectares"],a:0,s:"f=0.05m/hr. Q=180m¬≥/hr. A=Q/f=3600m¬≤=0.36ha."},
{i:323,t:"KPSC JE 2017",q:"GCA 6000 ha, 80% CCA. Intensity Kharif 25%. Area Kharif?",o:["600","1200","2400","4800"],a:1,s:"CCA=4800. Area=0.25*4800=1200."},
{i:324,t:"KPSC JE 2017",q:"60% Kharif and 46% Rabi without water. Intensity?",o:["126%","80%","124%","94%"],a:3,s:"(100-60) + (100-46) = 94%."},
{i:325,t:"Assam Engg 2021",q:"Water stored 60cm, Required 80cm. Storage Efficiency?",o:["50%","66.67%","100%","75%"],a:3,s:"(60/80)*100 = 75%."},
{i:326,t:"APPSC AE 2004",q:"Duty of crops requiring 1.08 m water over 120 days?",o:["960 ha/cumec","960 cumec/ha","1200 ha/cumec","1200 cumec/ha"],a:0,s:"D = 8.64*120/1.08 = 960."},
{i:327,t:"DMRC JE 2018",q:"First watering when crop is 1 cm high?",o:["Paleo","Water supplying","Kor watering","Sapling"],a:2,s:"Kor watering."},
{i:328,t:"APPSC AEE 2011",q:"Water unsuitable if Boron exceeds:",o:["0.5 ppm","1 ppm","1.3 ppm","2 ppm"],a:3,s:">2ppm is toxic."},
{i:329,t:"Gujarat PSC 2020",q:"Delta of well irrigation vs canal irrigation?",o:["4","3","1","0.6"],a:3,s:"Well delta is lower (~0.6-0.7 times) due to higher efficiency."},
{i:330,t:"Gujarat PSC 2020",q:"Volume from 1 cumec per day?",o:["86,400 m¬≥","8.64 m¬≥","86,400 ha-m","864 ha-m"],a:0,s:"1*24*3600 = 86400."},
{i:331,t:"Gujarat PSC 2020",q:"Superfluous water refers to",o:["Unsaturated zone","Surface tension","Static state","Drains deep below roots"],a:3,s:"Gravitational water."},
{i:332,t:"Gujarat PSC 2020",q:"Available moisture = ?",o:["FC - PWP","FC - RAM","FC + PWP","FC + RAM"],a:0,s:"FC - PWP."},
{i:333,t:"Gujarat PSC 2020",q:"Crop Water Use Efficiency?",o:["Yield / ET","Yield / Water used","Output / Input","Stored / Lost"],a:0,s:"Yield / Evapotranspiration."},
{i:334,t:"GPHC JE 2018",q:"Delta of Sugarcane?",o:["50 cm","60 cm","90 cm","150 cm"],a:3,s:"Usually 120-150cm."},
{i:335,t:"Punjab JE 2016",q:"Tube well 0.01 cumecs. Infiltration 5cm/hr. Max Area?",o:["360","720","1440","2880"],a:1,s:"A = Q/f = 0.01 / (0.05/3600) = 720."},
{i:336,t:"Punjab JE 2016",q:"Q req 3.6. CF 0.8, TF 0.6. Design Q?",o:["1.73","2.70","4.80","7.50"],a:3,s:"3.6 / (0.8*0.6) = 7.5."},
{i:337,t:"Punjab JE 2016",q:"FC 20%, PWP 13%. Available moisture?",o:["4.2%","7.0%","15.8%","17.2%"],a:1,s:"20 - 13 = 7%."},
{i:338,t:"NPCC 2017",q:"% reliably irrigated land in India (2010)?",o:["65","55","75","35"],a:3,s:"~35%."},
{i:339,t:"NPCC 2017",q:"Crop with longest base period?",o:["Rice","Maize","Sugarcane","Cotton"],a:2,s:"Sugarcane (~360 days)."},
{i:340,t:"WB AE 2020",q:"Highest delta value?",o:["Wheat","Vegetables","Rice","Cotton"],a:2,s:"Rice (~120cm)."},
{i:341,t:"ESE 2015",q:"3000 ha sugarcane, kor 173mm, 30 days. Q?",o:["2.0","1.0","20","0.20"],a:0,s:"D=1498. Q=3000/1498=2.0."},
{i:342,t:"ESE 2014",q:"FC 20%, PWP 10%, Rain 50mm, Depletion 50%. NIR?",o:["75mm","125mm","50mm","25mm"],a:3,s:"d=75mm. NIR=75-50=25mm."},
{i:343,t:"ESE 2014",q:"FC 30%, PWP 10%, Rain 30mm. NIR?",o:["300mm","150mm","120mm","90mm"],a:3,s:"d=120mm. NIR=120-30=90mm."},
{i:344,t:"ESE 2014",q:"Lift irrigation 96m¬≥/hr, Delta 0.375m, Intensity 60%. CCA?",o:["96","48","144","120"],a:2,s:"Area=92.16. CCA=153.6 -> 144."},
{i:345,t:"ESE 2014",q:"40ha, 8cumecs, 6hr. Stored 30cm. Efficiency?",o:["70%","80%","85%","90%"],a:0,s:"(120k/172.8k)=69.4%."},
{i:346,t:"ESE 2010",q:"Rabi 0.4, Kharif 0.3. CF 0.8, TF 0.5. Design Q?",o:["0.8","0.16","1.0","1.24"],a:2,s:"Max(0.4/0.4, 0.3/0.4) = 1.0."},
{i:347,t:"ESE 2011",q:"Zone not related to aeration?",o:["1 & 2","2 & 3","4","1"],a:3,s:"Saturation zone (1)."},
{i:348,t:"ESE 2011",q:"Assertion: Duty decreases away from field. Reason: Soil.",o:["Both true expl","Both true not expl","A true R false","A false R true"],a:3,s:"A is false. Duty increases away from field."},
{i:349,t:"ESE 2013",q:"Rice 2400ha, Duty 860. Vol?",o:["500","1400","2000","2880"],a:3,s:"Vol = Area * Delta = 2880 ha-m."},
{i:350,t:"ESE 2013",q:"70% Kharif, 46% Rabi no water. Intensity?",o:["116%","84%","42%","58%"],a:1,s:"30+54=84%."},
{i:351,t:"ESE 2007",q:"Q 0.4, CF 0.8, TF 0.5. Design?",o:["0.8","0.16","1.0","1.24"],a:2,s:"0.4/0.4 = 1.0."},
{i:352,t:"ESE 2009",q:"Cu 2.8mm/d. Avail 25% of 80mm. Freq?",o:["9","13","21","25"],a:2,s:"Use 60mm. 60/2.8=21."},
{i:353,t:"ESE 2009",q:"Irrigate when moisture falls below?",o:["1","2","3","2 & 3"],a:1,s:"Below field capacity (towards wilting)."},
{i:354,t:"ESE 2004",q:"Base 120, Delta 70cm. Duty?",o:["2480","1481","148","1.481"],a:1,s:"1481."},
{i:355,t:"ESE 2004",q:"CCA 1000, 50% int, Duty 2000. Q at head (25% loss)?",o:["3/16","1/4","1/3","1/2"],a:2,s:"Qfield=0.25. Qhead=0.25/0.75=1/3."},
{i:356,t:"KPSC JE 2016",q:"1m depth, 1.5g/cc, FC 30%, PWP 10%. Moisture?",o:["4000mm","300mm","200mm","150mm"],a:1,s:"1.5*1000*0.2 = 300mm."},
{i:357,t:"ESE 2001",q:"10m3/s, 4hr, 32ha. Stored 0.3m. Eff?",o:["96%","66.67%","48%","24%"],a:1,s:"In=144000, St=96000. 66.67%."},
{i:358,t:"ESE 2002",q:"Rice (1000,130,140). Wheat(50,119). Area?",o:["452","904","1105","2210"],a:3,s:"A2 = 2210."},
{i:359,t:"ESE 1997",q:"NIR? FC 20, PWP 10, Rain 25.",o:["75","125","50","25"],a:2,s:"d=75. NIR=50."},
{i:360,t:"ESE 1999",q:"A: Duty is unit volume. R: Duty head...",o:["Both true","Both true","A true","A false R true"],a:3,s:"Duty is unit discharge."},
{i:361,t:"Odisha JE 2015",q:"Consumptive use is:",o:["Interception","Evap","Trans","All"],a:3,s:"All inclusive."}
    ];

    let curr = 0;
    let time = 2 * 3600;
    let answers = {};
    let timerRef;

    // --- LOGIC ---
    function startTest() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('quiz-screen').classList.add('active');
        renderGrid();
        loadQ(0);
        
        timerRef = setInterval(() => {
            time--;
            if(time <= 0) submitTest();
            let h = Math.floor(time/3600).toString().padStart(2,'0');
            let m = Math.floor((time%3600)/60).toString().padStart(2,'0');
            let s = (time%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }

    function loadQ(idx) {
        curr = idx;
        const d = db[idx];
        const status = answers[idx] ? answers[idx].status : 'not';
        const sel = answers[idx] ? answers[idx].opt : null;

        const html = `
            <div class="q-card">
                <div class="meta">
                    <span class="tag">${d.t}</span>
                    <span>Q${d.i}</span>
                    <span style="font-weight:bold; color:#666;">+1.0 / -0.25</span>
                </div>
                <div class="q-text">${d.q}</div>
                <div class="opts">
                    ${d.o.map((o, i) => `
                        <div class="opt ${sel === i ? 'selected' : ''}" onclick="saveAns(${idx}, ${i})">
                            <div class="circle">${String.fromCharCode(65+i)}</div>
                            <div style="flex:1;">${o}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
        document.getElementById('q-area').innerHTML = html;
        updateGrid();
    }

    function saveAns(qIdx, oIdx) {
        if(!answers[qIdx]) answers[qIdx] = {};
        answers[qIdx].opt = oIdx;
        answers[qIdx].status = 'ans';
        loadQ(qIdx); // Refresh
    }

    function markReview() {
        if(!answers[curr]) answers[curr] = {};
        answers[curr].status = 'rev';
        updateGrid();
        nextQ();
    }

    function nextQ() {
        if(!answers[curr]) answers[curr] = {status: 'skip'};
        if(curr < db.length - 1) loadQ(curr + 1);
    }
    function prevQ() { if(curr > 0) loadQ(curr - 1); }

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = db.map((_, i) => `
            <div id="p-${i}" class="p-item" onclick="loadQ(${i})">${i+310}</div>
        `).join('');
    }

    function updateGrid() {
        db.forEach((_, i) => {
            const el = document.getElementById(`p-${i}`);
            let cls = 'p-item';
            if(i === curr) cls += ' current';
            if(answers[i]) cls += ` ${answers[i].status}`;
            el.className = cls;
        });
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function submitTest() {
        if(!confirm("Are you sure you want to Submit the Test?")) return;
        
        clearInterval(timerRef);
        document.getElementById('quiz-screen').classList.remove('active');
        document.getElementById('result-screen').classList.add('active');

        let score = 0, att = 0, correct = 0;
        let html = '';

        db.forEach((d, i) => {
            const a = answers[i];
            let badge = '<span class="badge b-skip">Skipped</span>';
            if(a && a.opt !== undefined) {
                att++;
                if(a.opt === d.a) {
                    score += 1; correct++; badge = '<span class="badge b-correct">Correct</span>';
                } else {
                    score -= 0.25; badge = '<span class="badge b-wrong">Wrong</span>';
                }
            }

            html += `
                <div class="sol-card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-weight:bold;">Q${d.i} (${d.t})</span>
                        ${badge}
                    </div>
                    <p style="margin-bottom:10px;">${d.q}</p>
                    <div style="font-size:0.9rem;">
                        Your Answer: <b>${a && a.opt !== undefined ? String.fromCharCode(65+a.opt) : '-'}</b> | 
                        Correct Answer: <b style="color:var(--green)">${String.fromCharCode(65+d.a)}</b>
                    </div>
                    <div class="expl"><b>Solution:</b> ${d.s}</div>
                </div>
            `;
        });

        // Save History
        let hist = JSON.parse(localStorage.getItem('myTestHistory') || '[]');
        hist.push({ date: new Date().toLocaleString(), score: score });
        localStorage.setItem('myTestHistory', JSON.stringify(hist));

        document.getElementById('score-txt').innerText = `${score} / ${db.length}`;
        document.getElementById('acc-txt').innerText = att ? ((correct/att)*100).toFixed(1)+'%' : '0%';
        document.getElementById('sol-container').innerHTML = html;
    }

    function showHistory() {
        let hist = JSON.parse(localStorage.getItem('myTestHistory') || '[]');
        if(hist.length === 0) alert("No history found.");
        else alert(hist.map(h => `${h.date}: ${h.score}`).join('\n'));
    }

</script>
</body>
</html>
